(function(e,t){function o(){this.init()}function u(){this.init()}function f(){this.init()}function l(e){arguments.length>0&&this.init(e)}function c(e){arguments.length>0&&this.init(e)}function h(e,t){arguments.length>0&&this.init(e,t)}function p(e,t){arguments.length>0&&this.init(e,t)}function d(){this.init(arguments)}function v(e,t){arguments.length>0&&this.init(e,t)}function m(e){arguments.length>0&&this.init(e)}function g(e){arguments.length>0&&this.init(e)}function y(e){arguments.length>0&&this.init(e)}function b(e,t,n){arguments.length>0&&this.init(e,t,n)}function w(e,t,n,r,i){arguments.length>0&&this.init(e,t,n,r,i)}function E(e,t,n){arguments.length>0&&this.init(e,t,n)}function S(e){arguments.length>0&&this.init(e)}function x(e,t){arguments.length>0&&this.init(e,t)}function T(e){arguments.length>0&&this.init(e)}function N(e,t,n,r){arguments.length>0&&this.init(e,t,n,r)}function C(e,t,n){arguments.length>0&&this.init("A",e,t,n)}function k(e,t,n){arguments.length>0&&this.init("Q",e,t,n)}function L(e,t,n){arguments.length>0&&this.init("C",e,t,n)}function A(e,t,n){arguments.length>0&&this.init("H",e,t,n)}function O(e,t,n){arguments.length>0&&this.init("L",e,t,n)}function M(e,t,n){arguments.length>0&&this.init("M",e,t,n)}function D(e,t,n){arguments.length>0&&this.init("T",e,t,n)}function P(e,t,n){arguments.length>0&&this.init("S",e,t,n)}function H(e,t,n,r){arguments.length>0&&this.init(e,t,n,r)}function B(e,t,n){arguments.length>0&&this.init("z",e,t,n)}function j(e,t,n){arguments.length>0&&this.init("q",e,t,n)}function F(e,t,n){arguments.length>0&&this.init("c",e,t,n)}function I(e,t,n){arguments.length>0&&this.init("l",e,t,n)}function q(e,t,n){arguments.length>0&&this.init("m",e,t,n)}function R(e,t,n){arguments.length>0&&this.init("t",e,t,n)}function U(e,t,n){arguments.length>0&&this.init("s",e,t,n)}function z(e){arguments.length>0&&this.init(e)}function W(e){arguments.length>0&&this.init(e)}function c(e){arguments.length>0&&this.init(e)}var n=e.define,r,s,t;(function(e){function p(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function d(t,n){return function(){return i.apply(e,h.call(arguments,0).concat([t,n]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){a[e]=t}}function g(t){if(f.hasOwnProperty(t)){var r=f[t];delete f[t],c[t]=!0,n.apply(e,r)}if(!a.hasOwnProperty(t)&&!c.hasOwnProperty(t))throw new Error("No "+t);return a[t]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return l&&l.config&&l.config[e]||{}}}var n,i,o,u,a={},f={},l={},c={},h=[].slice;o=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return d(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:b(e)}}},n=function(t,n,r,i){var s,l,h,p,v,y=[],b;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")y[v]=u.require(t);else if(l==="exports")y[v]=u.exports(t),b=!0;else if(l==="module")s=y[v]=u.module(t);else if(a.hasOwnProperty(l)||f.hasOwnProperty(l)||c.hasOwnProperty(l))y[v]=g(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,d(i,!0),m(l),{}),y[v]=a[l]}}h=r.apply(a[t],y);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!b)a[t]=h}else t&&(a[t]=r)},r=s=i=function(t,r,s,a,f){return typeof t=="string"?u[t]?u[t](r):g(o(t,r).f):(t.splice||(l=t,r.splice?(t=r,r=s,s=null):t=e),r=r||function(){},typeof s=="function"&&(s=a,a=f),a?n(e,t,r,s):setTimeout(function(){n(e,t,r,s)},15),i)},i.config=function(e){return l=e,i},t=function(e,t,n){t.splice||(n=t,t=[]),f[e]=[e,t,n]},t.amd={jQuery:!0}})(),t("../vendor/almond",function(){}),t("futuregrapher/core",[],function(){var e={VERSION:"0.9.1"};return e}),t("futuregrapher/typechecker",[],function(){return TypeChecker={enabled:!1,logToConsole:!1,checkProperties:function(e,t,n,r){if(!this.enabled)return;var i=this.logToConsole?function(e){console.log(e)}:function(){},s=_.keys(e),o=_.pluck(t,"propertyName");_.each(o,function(e){if(s.indexOf(e)===-1){var t="Required property '"+e+"' was not found";throw i(t),new Meteor.Error(t)}});if(r){var u=o.concat(_.pluck(n,"propertyName"));_.each(s,function(e){if(u.indexOf(e)===-1){var t="Property '"+e+"' is not among allowed properties";throw i(t),new Meteor.Error(t)}})}var a={};_.each(t.concat(n),function(e){a[e.propertyName]=e}),_.each(e,function(e,t){if(!a[t].validate(e)){var n="Property '"+t+"' should be a "+a[t].typeName+". Value was: "+e;throw i(n),new Meteor.Error(n)}})},object:function(e){return{typeName:"object",propertyName:e,validate:function(e){return typeof e=="object"}}},array:function(e){return{typeName:"array",propertyName:e,validate:function(e){return e instanceof Array}}},string:function(e){return{typeName:"string",propertyName:e,validate:function(e){return _.isNull(e)||typeof e=="string"}}},number:function(e){return{typeName:"number",propertyName:e,validate:function(e){return typeof e=="number"&&!isNaN(e)}}},nonNegativeNumber:function(e){return{typeName:"non-negative number",propertyName:e,validate:function(e){return typeof e=="number"&&e>=0}}},"boolean":function(e){return{typeName:"boolean",propertyName:e,validate:function(e){return typeof e=="boolean"}}},color:function(e){return{typeName:"color",propertyName:e,validate:function(e){return!_.isUndefined(e)}}}},TypeChecker}),t("futuregrapher/svgrendererdefaultoptions",["require"],function(e){var t={layerIds:["clusters","links","nodes","labels"]};return t}),Array.prototype.foreach=function(e){for(var t=0;t<this.length;t++)e(this[t])},Array.prototype.map=function(e){var t=new Array;for(var n=0;n<this.length;n++)t.push(e(this[n]));return t},Array.prototype.min=function(){var e=this[0];for(var t=0;t<this.length;t++)this[t]<e&&(e=this[t]);return e},Array.prototype.max=function(){var e=this[0];for(var t=0;t<this.length;t++)this[t]>e&&(e=this[t]);return e},o.VERSION="1.2",o.prototype.init=function(){var e=svgDocument.documentElement;this.svgNodes=new Array,this.x_trans=0,this.y_trans=0,this.scale=1,this.lastTM=e.createSVGMatrix(),e.addEventListener("SVGZoom",this,!1),e.addEventListener("SVGScroll",this,!1),e.addEventListener("SVGResize",this,!1)},o.prototype.appendNode=function(e){this.svgNodes.push(e)},o.prototype.removeNode=function(e){for(var t=0;t<this.svgNodes.length;t++)if(this.svgNodes[t]===e){this.svgNodes.splice(t,1);break}},o.prototype.handleEvent=function(e){var t=e.type;if(this[t]==null)throw new Error("Unsupported event type: "+t);this[t](e)},o.prototype.SVGZoom=function(e){this.update()},o.prototype.SVGScroll=function(e){this.update()},o.prototype.SVGResize=function(e){this.update()},o.prototype.update=function(){if(this.svgNodes.length>0){var e=svgDocument.documentElement,t=window.ViewBox!=null?new l(e):null,n=t!=null?t.getTM():e.createSVGMatrix(),r=e.currentTranslate;n=n.scale(1/e.currentScale),n=n.translate(-r.x,-r.y);for(var i=0;i<this.svgNodes.length;i++){var s=this.svgNodes[i],o=n.multiply(this.lastTM.multiply(s.getCTM())),u="matrix("+[o.a,o.b,o.c,o.d,o.e,o.f].join(",")+")";this.svgNodes[i].setAttributeNS(null,"transform",u)}this.lastTM=n.inverse()}},u.VERSION=1,u.prototype.init=function(){},u.prototype.handleEvent=function(e){if(this[e.type]==null)throw new Error("Unsupported event type: "+e.type);this[e.type](e)};var a="http://www.w3.org/2000/svg";f.prototype=new u,f.prototype.constructor=f,f.superclass=u.prototype,f.prototype.init=function(){this.svgNode=null,this.handles=new Array,this.shapes=new Array,this.lastPoint=null,this.currentNode=null,this.realize()},f.prototype.realize=function(){if(this.svgNode==null){var e=svgDocument.createElementNS(a,"rect");this.svgNode=e,e.setAttributeNS(null,"x","-32767"),e.setAttributeNS(null,"y","-32767"),e.setAttributeNS(null,"width","65535"),e.setAttributeNS(null,"height","65535"),e.setAttributeNS(null,"fill","none"),e.setAttributeNS(null,"pointer-events","all"),e.setAttributeNS(null,"display","none"),svgDocument.documentElement.appendChild(e)}},f.prototype.register=function(e){if(this.handleIndex(e)==-1){var t=e.owner;e.select(!0),this.handles.push(e),t!=null&&this.shapeIndex(t)==-1&&this.shapes.push(t)}},f.prototype.unregister=function(e){var t=this.handleIndex(e);t!=-1&&(e.select(!1),this.handles.splice(t,1))},f.prototype.registerShape=function(e){this.shapeIndex(e)==-1&&(e.select(!0),this.shapes.push(e))},f.prototype.unregisterShape=function(e){var t=this.shapeIndex(e);t!=-1&&(e.select(!1),e.selectHandles(!1),e.showHandles(!1),e.unregisterHandles(),this.shapes.splice(t,1))},f.prototype.unregisterAll=function(){for(var e=0;e<this.handles.length;e++)this.handles[e].select(!1);this.handles=new Array},f.prototype.unregisterShapes=function(){for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e];t.select(!1),t.selectHandles(!1),t.showHandles(!1),t.unregisterHandles()}this.shapes=new Array},f.prototype.handleIndex=function(e){var t=-1;for(var n=0;n<this.handles.length;n++)if(this.handles[n]===e){t=n;break}return t},f.prototype.shapeIndex=function(e){var t=-1;for(var n=0;n<this.shapes.length;n++)if(this.shapes[n]===e){t=n;break}return t},f.prototype.beginDrag=function(e){this.currentNode=e.target;var t=this.getUserCoordinate(this.currentNode,e.clientX,e.clientY);this.lastPoint=new p(t.x,t.y),this.svgNode.addEventListener("mouseup",this,!1),this.svgNode.addEventListener("mousemove",this,!1),svgDocument.documentElement.appendChild(this.svgNode),this.svgNode.setAttributeNS(null,"display","inline")},f.prototype.mouseup=function(e){this.lastPoint=null,this.currentNode=null,this.svgNode.removeEventListener("mouseup",this,!1),this.svgNode.removeEventListener("mousemove",this,!1),this.svgNode.setAttributeNS(null,"display","none")},f.prototype.mousemove=function(e){var t=this.getUserCoordinate(this.currentNode,e.clientX,e.clientY),n=new p(t.x,t.y),r=n.subtract(this.lastPoint),i=new Array,s=(new Date).getTime();this.lastPoint.setFromPoint(n);for(var o=0;o<this.handles.length;o++){var u=this.handles[o],a=u.owner;u.translate(r),a!=null?a.lastUpdate!=s&&(a.lastUpdate=s,i.push(a)):i.push(u)}for(var o=0;o<i.length;o++)i[o].update()},f.prototype.getUserCoordinate=function(e,t,n){var r=svgDocument.documentElement,i=r.getCurrentTranslate(),s=r.getCurrentScale(),o=this.getTransformToElement(e),u=o.inverse(),a=svgDocument.documentElement.createSVGPoint();return a.x=(t-i.x)/s,a.y=(n-i.y)/s,a.matrixTransform(u)},f.prototype.getTransformToElement=function(e){var t=e.getCTM();while((e=e.parentNode)!=svgDocument)t=e.getCTM().multiply(t);return t},l.VERSION="1.0",l.prototype.init=function(e){var t=e.getAttributeNS(null,"viewBox"),n=e.getAttributeNS(null,"preserveAspectRatio");if(t!=""){var r=t.split(/\s*,\s*|\s+/);this.x=parseFloat(r[0]),this.y=parseFloat(r[1]),this.width=parseFloat(r[2]),this.height=parseFloat(r[3])}else this.x=0,this.y=0,this.width=innerWidth,this.height=innerHeight;this.setPAR(n)},l.prototype.getTM=function(){var e=svgDocument.documentElement,t=svgDocument.documentElement.createSVGMatrix(),n=e.getAttributeNS(null,"width"),r=e.getAttributeNS(null,"height");n=n!=""?parseFloat(n):innerWidth,r=r!=""?parseFloat(r):innerHeight;var i=this.width/n,s=this.height/r;t=t.translate(this.x,this.y);if(this.alignX=="none")t=t.scaleNonUniform(i,s);else if(i<s&&this.meetOrSlice=="meet"||i>s&&this.meetOrSlice=="slice"){var o=0,u=n*s-this.width;this.alignX=="Mid"?o=-u/2:this.alignX=="Max"&&(o=-u),t=t.translate(o,0),t=t.scale(s)}else if(i>s&&this.meetOrSlice=="meet"||i<s&&this.meetOrSlice=="slice"){var a=0,f=r*i-this.height;this.alignY=="Mid"?a=-f/2:this.alignY=="Max"&&(a=-f),t=t.translate(0,a),t=t.scale(i)}else t=t.scale(i);return t},l.prototype.setPAR=function(e){if(e){var t=e.split(/\s+/),n=t[0];n=="none"?(this.alignX="none",this.alignY="none"):(this.alignX=n.substring(1,4),this.alignY=n.substring(5,9)),t.length==2?this.meetOrSlice=t[1]:this.meetOrSlice="meet"}else this.align="xMidYMid",this.alignX="Mid",this.alignY="Mid",this.meetOrSlice="meet"},c.prototype.init=function(e){this.status=e,this.points=new Array},c.prototype.appendPoint=function(e){this.points.push(e)},c.prototype.appendPoints=function(e){this.points=this.points.concat(e)},c.intersectShapes=function(e,t){var n=e.getIntersectionParams(),r=t.getIntersectionParams(),i;if(n!=null&&r!=null)if(n.name=="Path")i=c.intersectPathShape(e,t);else if(r.name=="Path")i=c.intersectPathShape(t,e);else{var s,o;n.name<r.name?(s="intersect"+n.name+r.name,o=n.params.concat(r.params)):(s="intersect"+r.name+n.name,o=r.params.concat(n.params));if(!(s in c))throw new Error("Intersection not available: "+s);i=c[s].apply(null,o)}else i=new c("No Intersection");return i},c.intersectPathShape=function(e,t){return e.intersectShape(t)},c.intersectBezier2Bezier2=function(e,t,n,r,i,s){var o,u,a,f,l,h,v,m,g=1e-4,y=new c("No Intersection");o=t.multiply(-2),a=e.add(o.add(n)),o=e.multiply(-2),u=t.multiply(2),f=o.add(u),l=new p(e.x,e.y),o=i.multiply(-2),h=r.add(o.add(s)),o=r.multiply(-2),u=i.multiply(2),v=o.add(u),m=new p(r.x,r.y);var o=a.x*f.y-f.x*a.y,u=h.x*f.y-f.x*h.y,b=v.x*f.y-f.x*v.y,w=f.x*(l.y-m.y)+f.y*(-l.x+m.x),E=h.x*a.y-a.x*h.y,S=v.x*a.y-a.x*v.y,x=a.x*(l.y-m.y)+a.y*(-l.x+m.x),T=new d(-E*E,-2*E*S,o*u-S*S-2*E*x,o*b-2*S*x,o*w-x*x),N=T.getRoots();for(var C=0;C<N.length;C++){var k=N[C];if(0<=k&&k<=1){var L=(new d(-a.x,-f.x,-l.x+m.x+k*v.x+k*k*h.x)).getRoots(),A=(new d(-a.y,-f.y,-l.y+m.y+k*v.y+k*k*h.y)).getRoots();if(L.length>0&&A.length>0)e:for(var O=0;O<L.length;O++){var M=L[O];if(0<=M&&M<=1)for(var _=0;_<A.length;_++)if(Math.abs(M-A[_])<g){y.points.push(h.multiply(k*k).add(v.multiply(k).add(m)));break e}}}}return y},c.intersectBezier2Bezier3=function(e,t,n,r,i,s,o){var u,a,f,l,h,m,g,y,b,w,E,S=new c("No Intersection");u=t.multiply(-2),h=e.add(u.add(n)),u=e.multiply(-2),a=t.multiply(2),m=u.add(a),g=new p(e.x,e.y),u=r.multiply(-1),a=i.multiply(3),f=s.multiply(-3),l=u.add(a.add(f.add(o))),y=new v(l.x,l.y),u=r.multiply(3),a=i.multiply(-6),f=s.multiply(3),l=u.add(a.add(f)),b=new v(l.x,l.y),u=r.multiply(-3),a=i.multiply(3),f=u.add(a),w=new v(f.x,f.y),E=new v(r.x,r.y);var x=g.x*g.x,T=g.y*g.y,N=m.x*m.x,C=m.y*m.y,k=h.x*h.x,L=h.y*h.y,A=E.x*E.x,O=E.y*E.y,M=w.x*w.x,_=w.y*w.y,D=b.x*b.x,P=b.y*b.y,H=y.x*y.x,B=y.y*y.y,j=new d(-2*h.x*h.y*y.x*y.y+k*B+L*H,-2*h.x*h.y*b.x*y.y-2*h.x*h.y*b.y*y.x+2*L*b.x*y.x+2*k*b.y*y.y,-2*h.x*w.x*h.y*y.y-2*h.x*h.y*w.y*y.x-2*h.x*h.y*b.x*b.y+2*w.x*L*y.x+L*D+k*(2*w.y*y.y+P),2*g.x*h.x*h.y*y.y+2*g.y*h.x*h.y*y.x+m.x*m.y*h.x*y.y+m.x*m.y*h.y*y.x-2*E.x*h.x*h.y*y.y-2*h.x*E.y*h.y*y.x-2*h.x*w.x*h.y*b.y-2*h.x*h.y*w.y*b.x-2*g.x*L*y.x-2*g.y*k*y.y+2*E.x*L*y.x+2*w.x*L*b.x-C*h.x*y.x-N*h.y*y.y+k*(2*E.y*y.y+2*w.y*b.y),2*g.x*h.x*h.y*b.y+2*g.y*h.x*h.y*b.x+m.x*m.y*h.x*b.y+m.x*m.y*h.y*b.x-2*E.x*h.x*h.y*b.y-2*h.x*E.y*h.y*b.x-2*h.x*w.x*h.y*w.y-2*g.x*L*b.x-2*g.y*k*b.y+2*E.x*L*b.x-C*h.x*b.x-N*h.y*b.y+M*L+k*(2*E.y*b.y+_),2*g.x*h.x*h.y*w.y+2*g.y*h.x*w.x*h.y+m.x*m.y*h.x*w.y+m.x*m.y*w.x*h.y-2*E.x*h.x*h.y*w.y-2*h.x*E.y*w.x*h.y-2*g.x*w.x*L-2*g.y*k*w.y+2*E.x*w.x*L-C*h.x*w.x-N*h.y*w.y+2*k*E.y*w.y,-2*g.x*g.y*h.x*h.y-g.x*m.x*m.y*h.y-g.y*m.x*m.y*h.x+2*g.x*h.x*E.y*h.y+2*g.y*E.x*h.x*h.y+m.x*E.x*m.y*h.y+m.x*m.y*h.x*E.y-2*E.x*h.x*E.y*h.y-2*g.x*E.x*L+g.x*C*h.x+g.y*N*h.y-2*g.y*k*E.y-E.x*C*h.x-N*E.y*h.y+x*L+T*k+A*L+k*O),F=j.getRootsInInterval(0,1);for(var I=0;I<F.length;I++){var q=F[I],R=(new d(h.x,m.x,g.x-E.x-q*w.x-q*q*b.x-q*q*q*y.x)).getRoots(),U=(new d(h.y,m.y,g.y-E.y-q*w.y-q*q*b.y-q*q*q*y.y)).getRoots();if(R.length>0&&U.length>0){var z=1e-4;e:for(var W=0;W<R.length;W++){var X=R[W];if(0<=X&&X<=1)for(var V=0;V<U.length;V++)if(Math.abs(X-U[V])<z){S.points.push(y.multiply(q*q*q).add(b.multiply(q*q).add(w.multiply(q).add(E))));break e}}}}return S.points.length>0&&(S.status="Intersection"),S},c.intersectBezier2Circle=function(e,t,n,r,i){return c.intersectBezier2Ellipse(e,t,n,r,i,i)},c.intersectBezier2Ellipse=function(e,t,n,r,i,s){var o,u,a,f,l,h=new c("No Intersection");o=t.multiply(-2),a=e.add(o.add(n)),o=e.multiply(-2),u=t.multiply(2),f=o.add(u),l=new p(e.x,e.y);var v=i*i,m=s*s,g=(new d(m*a.x*a.x+v*a.y*a.y,2*(m*a.x*f.x+v*a.y*f.y),m*(2*a.x*l.x+f.x*f.x)+v*(2*a.y*l.y+f.y*f.y)-2*(m*r.x*a.x+v*r.y*a.y),2*(m*f.x*(l.x-r.x)+v*f.y*(l.y-r.y)),m*(l.x*l.x+r.x*r.x)+v*(l.y*l.y+r.y*r.y)-2*(m*r.x*l.x+v*r.y*l.y)-v*m)).getRoots();for(var y=0;y<g.length;y++){var b=g[y];0<=b&&b<=1&&h.points.push(a.multiply(b*b).add(f.multiply(b).add(l)))}return h.points.length>0&&(h.status="Intersection"),h},c.intersectBezier2Line=function(e,t,n,r,i){var s,o,u,a,f,l,h,m=r.min(i),g=r.max(i),y=new c("No Intersection");s=t.multiply(-2),u=e.add(s.add(n)),s=e.multiply(-2),o=t.multiply(2),a=s.add(o),f=new p(e.x,e.y),h=new v(r.y-i.y,i.x-r.x),l=r.x*i.y-i.x*r.y,roots=(new d(h.dot(u),h.dot(a),h.dot(f)+l)).getRoots();for(var b=0;b<roots.length;b++){var w=roots[b];if(0<=w&&w<=1){var E=e.lerp(t,w),S=t.lerp(n,w),x=E.lerp(S,w);r.x==i.x?m.y<=x.y&&x.y<=g.y&&(y.status="Intersection",y.appendPoint(x)):r.y==i.y?m.x<=x.x&&x.x<=g.x&&(y.status="Intersection",y.appendPoint(x)):x.gte(m)&&x.lte(g)&&(y.status="Intersection",y.appendPoint(x))}}return y},c.intersectBezier2Polygon=function(e,t,n,r){var i=new c("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=c.intersectBezier2Line(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},c.intersectBezier2Rectangle=function(e,t,n,r,i){var s=r.min(i),o=r.max(i),u=new p(o.x,s.y),a=new p(s.x,o.y),f=c.intersectBezier2Line(e,t,n,s,u),l=c.intersectBezier2Line(e,t,n,u,o),h=c.intersectBezier2Line(e,t,n,o,a),d=c.intersectBezier2Line(e,t,n,a,s),v=new c("No Intersection");return v.appendPoints(f.points),v.appendPoints(l.points),v.appendPoints(h.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v},c.intersectBezier3Bezier3=function(e,t,n,r,i,s,o,u){var a,f,l,h,p,m,g,y,b,w,E,S,x=new c("No Intersection");a=e.multiply(-1),f=t.multiply(3),l=n.multiply(-3),h=a.add(f.add(l.add(r))),p=new v(h.x,h.y),a=e.multiply(3),f=t.multiply(-6),l=n.multiply(3),h=a.add(f.add(l)),m=new v(h.x,h.y),a=e.multiply(-3),f=t.multiply(3),l=a.add(f),g=new v(l.x,l.y),y=new v(e.x,e.y),a=i.multiply(-1),f=s.multiply(3),l=o.multiply(-3),h=a.add(f.add(l.add(u))),b=new v(h.x,h.y),a=i.multiply(3),f=s.multiply(-6),l=o.multiply(3),h=a.add(f.add(l)),w=new v(h.x,h.y),a=i.multiply(-3),f=s.multiply(3),l=a.add(f),E=new v(l.x,l.y),S=new v(i.x,i.y);var T=y.x*y.x,N=y.x*y.x*y.x,C=y.y*y.y,k=y.y*y.y*y.y,L=g.x*g.x,A=g.x*g.x*g.x,O=g.y*g.y,M=g.y*g.y*g.y,_=m.x*m.x,D=m.x*m.x*m.x,P=m.y*m.y,H=m.y*m.y*m.y,B=p.x*p.x,j=p.x*p.x*p.x,F=p.y*p.y,I=p.y*p.y*p.y,q=S.x*S.x,R=S.x*S.x*S.x,U=S.y*S.y,z=S.y*S.y*S.y,W=E.x*E.x,X=E.x*E.x*E.x,V=E.y*E.y,$=w.x*w.x,J=w.x*w.x*w.x,K=w.y*w.y,Q=b.x*b.x,G=b.x*b.x*b.x,Y=b.y*b.y,Z=b.y*b.y*b.y,et=new d(-j*Z+I*G-3*p.x*F*Q*b.y+3*B*p.y*b.x*Y,-6*p.x*w.x*F*b.x*b.y+6*B*p.y*w.y*b.x*b.y+3*w.x*I*Q-3*j*w.y*Y-3*p.x*F*w.y*Q+3*B*w.x*p.y*Y,-6*E.x*p.x*F*b.x*b.y-6*p.x*w.x*F*w.y*b.x+6*B*w.x*p.y*w.y*b.y+3*E.x*I*Q+3*$*I*b.x+3*E.x*B*p.y*Y-3*p.x*E.y*F*Q-3*p.x*$*F*b.y+B*p.y*b.x*(6*E.y*b.y+3*K)+j*(-E.y*Y-2*K*b.y-b.y*(2*E.y*b.y+K)),g.x*m.y*p.x*p.y*b.x*b.y-g.y*m.x*p.x*p.y*b.x*b.y+6*E.x*w.x*I*b.x+3*g.x*m.x*p.x*p.y*Y+6*y.x*p.x*F*b.x*b.y-3*g.x*m.x*F*b.x*b.y-3*g.y*m.y*p.x*p.y*Q-6*y.y*B*p.y*b.x*b.y-6*S.x*p.x*F*b.x*b.y+3*g.y*m.y*B*b.x*b.y-2*m.x*P*p.x*b.x*b.y-6*E.x*p.x*w.x*F*b.y-6*E.x*p.x*F*w.y*b.x-6*p.x*E.y*w.x*F*b.x+6*E.x*B*p.y*w.y*b.y+2*_*m.y*p.y*b.x*b.y+J*I-3*y.x*I*Q+3*y.y*j*Y+3*S.x*I*Q+H*p.x*Q-D*p.y*Y-3*y.x*B*p.y*Y+3*y.y*p.x*F*Q-2*g.x*m.y*B*Y+g.x*m.y*F*Q-g.y*m.x*B*Y+2*g.y*m.x*F*Q+3*S.x*B*p.y*Y-m.x*P*p.y*Q-3*S.y*p.x*F*Q+_*m.y*p.x*Y-3*p.x*$*F*w.y+B*p.y*b.x*(6*S.y*b.y+6*E.y*w.y)+B*w.x*p.y*(6*E.y*b.y+3*K)+j*(-2*E.y*w.y*b.y-S.y*Y-w.y*(2*E.y*b.y+K)-b.y*(2*S.y*b.y+2*E.y*w.y)),6*g.x*m.x*p.x*p.y*w.y*b.y+g.x*m.y*p.x*w.x*p.y*b.y+g.x*m.y*p.x*p.y*w.y*b.x-g.y*m.x*p.x*w.x*p.y*b.y-g.y*m.x*p.x*p.y*w.y*b.x-6*g.y*m.y*p.x*w.x*p.y*b.x-6*y.x*w.x*I*b.x+6*S.x*w.x*I*b.x+6*y.y*j*w.y*b.y+2*H*p.x*w.x*b.x-2*D*p.y*w.y*b.y+6*y.x*p.x*w.x*F*b.y+6*y.x*p.x*F*w.y*b.x+6*y.y*p.x*w.x*F*b.x-3*g.x*m.x*w.x*F*b.y-3*g.x*m.x*F*w.y*b.x+2*g.x*m.y*w.x*F*b.x+4*g.y*m.x*w.x*F*b.x-6*y.x*B*p.y*w.y*b.y-6*y.y*B*w.x*p.y*b.y-6*y.y*B*p.y*w.y*b.x-4*g.x*m.y*B*w.y*b.y-6*S.x*p.x*w.x*F*b.y-6*S.x*p.x*F*w.y*b.x-2*g.y*m.x*B*w.y*b.y+3*g.y*m.y*B*w.x*b.y+3*g.y*m.y*B*w.y*b.x-2*m.x*P*p.x*w.x*b.y-2*m.x*P*p.x*w.y*b.x-2*m.x*P*w.x*p.y*b.x-6*S.y*p.x*w.x*F*b.x-6*E.x*p.x*E.y*F*b.x-6*E.x*p.x*w.x*F*w.y+6*S.x*B*p.y*w.y*b.y+2*_*m.y*p.x*w.y*b.y+2*_*m.y*w.x*p.y*b.y+2*_*m.y*p.y*w.y*b.x+3*E.x*$*I+3*W*I*b.x-3*p.x*E.y*$*F-3*W*p.x*F*b.y+B*w.x*p.y*(6*S.y*b.y+6*E.y*w.y)+B*p.y*b.x*(6*S.y*w.y+3*V)+E.x*B*p.y*(6*E.y*b.y+3*K)+j*(-2*S.y*w.y*b.y-b.y*(2*S.y*w.y+V)-E.y*(2*E.y*b.y+K)-w.y*(2*S.y*b.y+2*E.y*w.y)),g.x*E.x*m.y*p.x*p.y*b.y+g.x*m.y*p.x*E.y*p.y*b.x+g.x*m.y*p.x*w.x*p.y*w.y-g.y*m.x*E.x*p.x*p.y*b.y-g.y*m.x*p.x*E.y*p.y*b.x-g.y*m.x*p.x*w.x*p.y*w.y-6*g.y*E.x*m.y*p.x*p.y*b.x-6*y.x*E.x*I*b.x+6*S.x*E.x*I*b.x+2*E.x*H*p.x*b.x+6*y.x*E.x*p.x*F*b.y+6*y.x*p.x*E.y*F*b.x+6*y.x*p.x*w.x*F*w.y+6*y.y*E.x*p.x*F*b.x-3*g.x*m.x*E.x*F*b.y-3*g.x*m.x*E.y*F*b.x-3*g.x*m.x*w.x*F*w.y+2*g.x*E.x*m.y*F*b.x+4*g.y*m.x*E.x*F*b.x-6*y.y*E.x*B*p.y*b.y-6*y.y*B*E.y*p.y*b.x-6*y.y*B*w.x*p.y*w.y-6*S.x*E.x*p.x*F*b.y-6*S.x*p.x*E.y*F*b.x-6*S.x*p.x*w.x*F*w.y+3*g.y*E.x*m.y*B*b.y-3*g.y*m.y*p.x*$*p.y+3*g.y*m.y*B*E.y*b.x+3*g.y*m.y*B*w.x*w.y-2*m.x*E.x*P*p.x*b.y-2*m.x*E.x*P*p.y*b.x-2*m.x*P*p.x*E.y*b.x-2*m.x*P*p.x*w.x*w.y-6*S.y*E.x*p.x*F*b.x-6*E.x*p.x*E.y*w.x*F+6*S.y*B*E.y*p.y*b.x+2*_*E.x*m.y*p.y*b.y+2*_*m.y*E.y*p.y*b.x+2*_*m.y*w.x*p.y*w.y-3*y.x*$*I+3*S.x*$*I+3*W*w.x*I+H*p.x*$+3*y.y*p.x*$*F+g.x*m.y*$*F+2*g.y*m.x*$*F-m.x*P*$*p.y-3*S.y*p.x*$*F-3*W*p.x*F*w.y+_*m.y*p.x*(2*E.y*b.y+K)+g.x*m.x*p.x*p.y*(6*E.y*b.y+3*K)+E.x*B*p.y*(6*S.y*b.y+6*E.y*w.y)+D*p.y*(-2*E.y*b.y-K)+y.y*j*(6*E.y*b.y+3*K)+g.y*m.x*B*(-2*E.y*b.y-K)+g.x*m.y*B*(-4*E.y*b.y-2*K)+y.x*B*p.y*(-6*E.y*b.y-3*K)+B*w.x*p.y*(6*S.y*w.y+3*V)+S.x*B*p.y*(6*E.y*b.y+3*K)+j*(-2*S.y*E.y*b.y-w.y*(2*S.y*w.y+V)-S.y*(2*E.y*b.y+K)-E.y*(2*S.y*b.y+2*E.y*w.y)),-y.x*g.x*m.y*p.x*p.y*b.y+y.x*g.y*m.x*p.x*p.y*b.y+6*y.x*g.y*m.y*p.x*p.y*b.x-6*y.y*g.x*m.x*p.x*p.y*b.y-y.y*g.x*m.y*p.x*p.y*b.x+y.y*g.y*m.x*p.x*p.y*b.x+g.x*g.y*m.x*m.y*p.x*b.y-g.x*g.y*m.x*m.y*p.y*b.x+g.x*S.x*m.y*p.x*p.y*b.y+g.x*S.y*m.y*p.x*p.y*b.x+g.x*E.x*m.y*p.x*p.y*w.y+g.x*m.y*p.x*E.y*w.x*p.y-S.x*g.y*m.x*p.x*p.y*b.y-6*S.x*g.y*m.y*p.x*p.y*b.x-g.y*m.x*S.y*p.x*p.y*b.x-g.y*m.x*E.x*p.x*p.y*w.y-g.y*m.x*p.x*E.y*w.x*p.y-6*g.y*E.x*m.y*p.x*w.x*p.y-6*y.x*S.x*I*b.x-6*y.x*E.x*w.x*I-2*y.x*H*p.x*b.x+6*S.x*E.x*w.x*I+2*S.x*H*p.x*b.x+2*E.x*H*p.x*w.x+2*y.y*D*p.y*b.y-6*y.x*y.y*p.x*F*b.x+3*y.x*g.x*m.x*F*b.y-2*y.x*g.x*m.y*F*b.x-4*y.x*g.y*m.x*F*b.x+3*y.y*g.x*m.x*F*b.x+6*y.x*y.y*B*p.y*b.y+6*y.x*S.x*p.x*F*b.y-3*y.x*g.y*m.y*B*b.y+2*y.x*m.x*P*p.x*b.y+2*y.x*m.x*P*p.y*b.x+6*y.x*S.y*p.x*F*b.x+6*y.x*E.x*p.x*F*w.y+6*y.x*p.x*E.y*w.x*F+4*y.y*g.x*m.y*B*b.y+6*y.y*S.x*p.x*F*b.x+2*y.y*g.y*m.x*B*b.y-3*y.y*g.y*m.y*B*b.x+2*y.y*m.x*P*p.x*b.x+6*y.y*E.x*p.x*w.x*F-3*g.x*S.x*m.x*F*b.y+2*g.x*S.x*m.y*F*b.x+g.x*g.y*P*p.x*b.x-3*g.x*m.x*S.y*F*b.x-3*g.x*m.x*E.x*F*w.y-3*g.x*m.x*E.y*w.x*F+2*g.x*E.x*m.y*w.x*F+4*S.x*g.y*m.x*F*b.x+4*g.y*m.x*E.x*w.x*F-2*y.x*_*m.y*p.y*b.y-6*y.y*S.x*B*p.y*b.y-6*y.y*S.y*B*p.y*b.x-6*y.y*E.x*B*p.y*w.y-2*y.y*_*m.y*p.x*b.y-2*y.y*_*m.y*p.y*b.x-6*y.y*B*E.y*w.x*p.y-g.x*g.y*_*p.y*b.y-2*g.x*O*p.x*p.y*b.x+3*S.x*g.y*m.y*B*b.y-2*S.x*m.x*P*p.x*b.y-2*S.x*m.x*P*p.y*b.x-6*S.x*S.y*p.x*F*b.x-6*S.x*E.x*p.x*F*w.y-6*S.x*p.x*E.y*w.x*F+3*g.y*S.y*m.y*B*b.x+3*g.y*E.x*m.y*B*w.y+3*g.y*m.y*B*E.y*w.x-2*m.x*S.y*P*p.x*b.x-2*m.x*E.x*P*p.x*w.y-2*m.x*E.x*P*w.x*p.y-2*m.x*P*p.x*E.y*w.x-6*S.y*E.x*p.x*w.x*F-O*m.x*m.y*p.x*b.x+2*S.x*_*m.y*p.y*b.y+6*S.y*B*E.y*w.x*p.y+2*L*g.y*p.x*p.y*b.y+L*m.x*m.y*p.y*b.y+2*_*S.y*m.y*p.y*b.x+2*_*E.x*m.y*p.y*w.y+2*_*m.y*E.y*w.x*p.y+X*I+3*T*I*b.x-3*C*j*b.y+3*q*I*b.x+M*B*b.x-A*F*b.y-g.x*O*B*b.y+L*g.y*F*b.x-3*T*p.x*F*b.y+3*C*B*p.y*b.x-L*P*p.x*b.y+O*_*p.y*b.x-3*W*p.x*E.y*F-3*q*p.x*F*b.y+3*U*B*p.y*b.x+g.x*m.x*p.x*p.y*(6*S.y*b.y+6*E.y*w.y)+D*p.y*(-2*S.y*b.y-2*E.y*w.y)+y.y*j*(6*S.y*b.y+6*E.y*w.y)+g.y*m.x*B*(-2*S.y*b.y-2*E.y*w.y)+_*m.y*p.x*(2*S.y*b.y+2*E.y*w.y)+g.x*m.y*B*(-4*S.y*b.y-4*E.y*w.y)+y.x*B*p.y*(-6*S.y*b.y-6*E.y*w.y)+S.x*B*p.y*(6*S.y*b.y+6*E.y*w.y)+E.x*B*p.y*(6*S.y*w.y+3*V)+j*(-2*S.y*E.y*w.y-U*b.y-E.y*(2*S.y*w.y+V)-S.y*(2*S.y*b.y+2*E.y*w.y)),-y.x*g.x*m.y*p.x*p.y*w.y+y.x*g.y*m.x*p.x*p.y*w.y+6*y.x*g.y*m.y*p.x*w.x*p.y-6*y.y*g.x*m.x*p.x*p.y*w.y-y.y*g.x*m.y*p.x*w.x*p.y+y.y*g.y*m.x*p.x*w.x*p.y+g.x*g.y*m.x*m.y*p.x*w.y-g.x*g.y*m.x*m.y*w.x*p.y+g.x*S.x*m.y*p.x*p.y*w.y+g.x*S.y*m.y*p.x*w.x*p.y+g.x*E.x*m.y*p.x*E.y*p.y-S.x*g.y*m.x*p.x*p.y*w.y-6*S.x*g.y*m.y*p.x*w.x*p.y-g.y*m.x*S.y*p.x*w.x*p.y-g.y*m.x*E.x*p.x*E.y*p.y-6*y.x*S.x*w.x*I-2*y.x*H*p.x*w.x+2*S.x*H*p.x*w.x+2*y.y*D*p.y*w.y-6*y.x*y.y*p.x*w.x*F+3*y.x*g.x*m.x*F*w.y-2*y.x*g.x*m.y*w.x*F-4*y.x*g.y*m.x*w.x*F+3*y.y*g.x*m.x*w.x*F+6*y.x*y.y*B*p.y*w.y+6*y.x*S.x*p.x*F*w.y-3*y.x*g.y*m.y*B*w.y+2*y.x*m.x*P*p.x*w.y+2*y.x*m.x*P*w.x*p.y+6*y.x*S.y*p.x*w.x*F+6*y.x*E.x*p.x*E.y*F+4*y.y*g.x*m.y*B*w.y+6*y.y*S.x*p.x*w.x*F+2*y.y*g.y*m.x*B*w.y-3*y.y*g.y*m.y*B*w.x+2*y.y*m.x*P*p.x*w.x-3*g.x*S.x*m.x*F*w.y+2*g.x*S.x*m.y*w.x*F+g.x*g.y*P*p.x*w.x-3*g.x*m.x*S.y*w.x*F-3*g.x*m.x*E.x*E.y*F+4*S.x*g.y*m.x*w.x*F-2*y.x*_*m.y*p.y*w.y-6*y.y*S.x*B*p.y*w.y-6*y.y*S.y*B*w.x*p.y-6*y.y*E.x*B*E.y*p.y-2*y.y*_*m.y*p.x*w.y-2*y.y*_*m.y*w.x*p.y-g.x*g.y*_*p.y*w.y-2*g.x*O*p.x*w.x*p.y+3*S.x*g.y*m.y*B*w.y-2*S.x*m.x*P*p.x*w.y-2*S.x*m.x*P*w.x*p.y-6*S.x*S.y*p.x*w.x*F-6*S.x*E.x*p.x*E.y*F+3*g.y*S.y*m.y*B*w.x+3*g.y*E.x*m.y*B*E.y-2*m.x*S.y*P*p.x*w.x-2*m.x*E.x*P*p.x*E.y-O*m.x*m.y*p.x*w.x+2*S.x*_*m.y*p.y*w.y-3*g.y*W*m.y*p.x*p.y+6*S.y*E.x*B*E.y*p.y+2*L*g.y*p.x*p.y*w.y+L*m.x*m.y*p.y*w.y+2*_*S.y*m.y*w.x*p.y+2*_*E.x*m.y*E.y*p.y-3*y.x*W*I+3*S.x*W*I+3*T*w.x*I-3*C*j*w.y+3*q*w.x*I+W*H*p.x+M*B*w.x-A*F*w.y+3*y.y*W*p.x*F-g.x*O*B*w.y+g.x*W*m.y*F+2*g.y*m.x*W*F+L*g.y*w.x*F-m.x*W*P*p.y-3*S.y*W*p.x*F-3*T*p.x*F*w.y+3*C*B*w.x*p.y-L*P*p.x*w.y+O*_*w.x*p.y-3*q*p.x*F*w.y+3*U*B*w.x*p.y+_*m.y*p.x*(2*S.y*w.y+V)+g.x*m.x*p.x*p.y*(6*S.y*w.y+3*V)+D*p.y*(-2*S.y*w.y-V)+y.y*j*(6*S.y*w.y+3*V)+g.y*m.x*B*(-2*S.y*w.y-V)+g.x*m.y*B*(-4*S.y*w.y-2*V)+y.x*B*p.y*(-6*S.y*w.y-3*V)+S.x*B*p.y*(6*S.y*w.y+3*V)+j*(-2*S.y*V-U*w.y-S.y*(2*S.y*w.y+V)),-y.x*g.x*m.y*p.x*E.y*p.y+y.x*g.y*m.x*p.x*E.y*p.y+6*y.x*g.y*E.x*m.y*p.x*p.y-6*y.y*g.x*m.x*p.x*E.y*p.y-y.y*g.x*E.x*m.y*p.x*p.y+y.y*g.y*m.x*E.x*p.x*p.y-g.x*g.y*m.x*E.x*m.y*p.y+g.x*g.y*m.x*m.y*p.x*E.y+g.x*S.x*m.y*p.x*E.y*p.y+6*g.x*m.x*S.y*p.x*E.y*p.y+g.x*S.y*E.x*m.y*p.x*p.y-S.x*g.y*m.x*p.x*E.y*p.y-6*S.x*g.y*E.x*m.y*p.x*p.y-g.y*m.x*S.y*E.x*p.x*p.y-6*y.x*S.x*E.x*I-2*y.x*E.x*H*p.x+6*y.y*S.y*j*E.y+2*S.x*E.x*H*p.x+2*y.y*D*E.y*p.y-2*D*S.y*E.y*p.y-6*y.x*y.y*E.x*p.x*F+3*y.x*g.x*m.x*E.y*F-2*y.x*g.x*E.x*m.y*F-4*y.x*g.y*m.x*E.x*F+3*y.y*g.x*m.x*E.x*F+6*y.x*y.y*B*E.y*p.y+6*y.x*S.x*p.x*E.y*F-3*y.x*g.y*m.y*B*E.y+2*y.x*m.x*E.x*P*p.y+2*y.x*m.x*P*p.x*E.y+6*y.x*S.y*E.x*p.x*F+4*y.y*g.x*m.y*B*E.y+6*y.y*S.x*E.x*p.x*F+2*y.y*g.y*m.x*B*E.y-3*y.y*g.y*E.x*m.y*B+2*y.y*m.x*E.x*P*p.x-3*g.x*S.x*m.x*E.y*F+2*g.x*S.x*E.x*m.y*F+g.x*g.y*E.x*P*p.x-3*g.x*m.x*S.y*E.x*F+4*S.x*g.y*m.x*E.x*F-6*y.x*S.y*B*E.y*p.y-2*y.x*_*m.y*E.y*p.y-6*y.y*S.x*B*E.y*p.y-6*y.y*S.y*E.x*B*p.y-2*y.y*_*E.x*m.y*p.y-2*y.y*_*m.y*p.x*E.y-g.x*g.y*_*E.y*p.y-4*g.x*S.y*m.y*B*E.y-2*g.x*O*E.x*p.x*p.y+3*S.x*g.y*m.y*B*E.y-2*S.x*m.x*E.x*P*p.y-2*S.x*m.x*P*p.x*E.y-6*S.x*S.y*E.x*p.x*F-2*g.y*m.x*S.y*B*E.y+3*g.y*S.y*E.x*m.y*B-2*m.x*S.y*E.x*P*p.x-O*m.x*E.x*m.y*p.x+6*S.x*S.y*B*E.y*p.y+2*S.x*_*m.y*E.y*p.y+2*L*g.y*p.x*E.y*p.y+L*m.x*m.y*E.y*p.y+2*_*S.y*E.x*m.y*p.y+2*_*S.y*m.y*p.x*E.y+3*T*E.x*I-3*C*j*E.y+3*q*E.x*I+M*E.x*B-A*E.y*F-3*U*j*E.y-g.x*O*B*E.y+L*g.y*E.x*F-3*T*p.x*E.y*F+3*C*E.x*B*p.y-L*P*p.x*E.y+O*_*E.x*p.y-3*q*p.x*E.y*F+3*U*E.x*B*p.y,y.x*y.y*g.x*m.y*p.x*p.y-y.x*y.y*g.y*m.x*p.x*p.y+y.x*g.x*g.y*m.x*m.y*p.y-y.y*g.x*g.y*m.x*m.y*p.x-y.x*g.x*S.y*m.y*p.x*p.y+6*y.x*S.x*g.y*m.y*p.x*p.y+y.x*g.y*m.x*S.y*p.x*p.y-y.y*g.x*S.x*m.y*p.x*p.y-6*y.y*g.x*m.x*S.y*p.x*p.y+y.y*S.x*g.y*m.x*p.x*p.y-g.x*S.x*g.y*m.x*m.y*p.y+g.x*g.y*m.x*S.y*m.y*p.x+g.x*S.x*S.y*m.y*p.x*p.y-S.x*g.y*m.x*S.y*p.x*p.y-2*y.x*S.x*H*p.x+2*y.y*D*S.y*p.y-3*y.x*y.y*g.x*m.x*F-6*y.x*y.y*S.x*p.x*F+3*y.x*y.y*g.y*m.y*B-2*y.x*y.y*m.x*P*p.x-2*y.x*g.x*S.x*m.y*F-y.x*g.x*g.y*P*p.x+3*y.x*g.x*m.x*S.y*F-4*y.x*S.x*g.y*m.x*F+3*y.y*g.x*S.x*m.x*F+6*y.x*y.y*S.y*B*p.y+2*y.x*y.y*_*m.y*p.y+2*y.x*g.x*O*p.x*p.y+2*y.x*S.x*m.x*P*p.y+6*y.x*S.x*S.y*p.x*F-3*y.x*g.y*S.y*m.y*B+2*y.x*m.x*S.y*P*p.x+y.x*O*m.x*m.y*p.x+y.y*g.x*g.y*_*p.y+4*y.y*g.x*S.y*m.y*B-3*y.y*S.x*g.y*m.y*B+2*y.y*S.x*m.x*P*p.x+2*y.y*g.y*m.x*S.y*B+g.x*S.x*g.y*P*p.x-3*g.x*S.x*m.x*S.y*F-2*y.x*_*S.y*m.y*p.y-6*y.y*S.x*S.y*B*p.y-2*y.y*S.x*_*m.y*p.y-2*y.y*L*g.y*p.x*p.y-y.y*L*m.x*m.y*p.y-2*y.y*_*S.y*m.y*p.x-2*g.x*S.x*O*p.x*p.y-g.x*g.y*_*S.y*p.y+3*S.x*g.y*S.y*m.y*B-2*S.x*m.x*S.y*P*p.x-S.x*O*m.x*m.y*p.x+3*C*g.x*m.x*p.x*p.y+3*g.x*m.x*U*p.x*p.y+2*S.x*_*S.y*m.y*p.y-3*T*g.y*m.y*p.x*p.y+2*L*g.y*S.y*p.x*p.y+L*m.x*S.y*m.y*p.y-3*q*g.y*m.y*p.x*p.y-N*I+k*j+R*I-z*j-3*y.x*q*I-y.x*M*B+3*T*S.x*I+y.y*A*F+3*y.y*U*j+S.x*M*B+T*H*p.x-3*C*S.y*j-C*D*p.y+q*H*p.x-A*S.y*F-D*U*p.y-y.x*L*g.y*F+y.y*g.x*O*B-3*y.x*C*B*p.y-y.x*O*_*p.y+y.y*L*P*p.x-g.x*O*S.y*B+3*T*y.y*p.x*F+T*g.x*m.y*F+2*T*g.y*m.x*F-2*C*g.x*m.y*B-C*g.y*m.x*B+L*S.x*g.y*F-3*y.x*U*B*p.y+3*y.y*q*p.x*F+g.x*q*m.y*F-2*g.x*U*m.y*B+S.x*O*_*p.y-g.y*m.x*U*B-T*m.x*P*p.y-3*T*S.y*p.x*F+3*C*S.x*B*p.y+C*_*m.y*p.x-L*S.y*P*p.x+2*q*g.y*m.x*F+3*S.x*U*B*p.y-q*m.x*P*p.y-3*q*S.y*p.x*F+_*U*m.y*p.x),tt=et.getRootsInInterval(0,1);for(var nt=0;nt<tt.length;nt++){var rt=tt[nt],it=(new d(p.x,m.x,g.x,y.x-S.x-rt*E.x-rt*rt*w.x-rt*rt*rt*b.x)).getRoots(),st=(new d(p.y,m.y,g.y,y.y-S.y-rt*E.y-rt*rt*w.y-rt*rt*rt*b.y)).getRoots();if(it.length>0&&st.length>0){var ot=1e-4;e:for(var ut=0;ut<it.length;ut++){var at=it[ut];if(0<=at&&at<=1)for(var ft=0;ft<st.length;ft++)if(Math.abs(at-st[ft])<ot){x.points.push(b.multiply(rt*rt*rt).add(w.multiply(rt*rt).add(E.multiply(rt).add(S))));break e}}}}return x.points.length>0&&(x.status="Intersection"),x},c.intersectBezier3Circle=function(e,t,n,r,i,s){return c.intersectBezier3Ellipse(e,t,n,r,i,s,s)},c.intersectBezier3Ellipse=function(e,t,n,r,i,s,o){var u,a,f,l,h,p,m,g,y=new c("No Intersection");u=e.multiply(-1),a=t.multiply(3),f=n.multiply(-3),l=u.add(a.add(f.add(r))),h=new v(l.x,l.y),u=e.multiply(3),a=t.multiply(-6),f=n.multiply(3),l=u.add(a.add(f)),p=new v(l.x,l.y),u=e.multiply(-3),a=t.multiply(3),f=u.add(a),m=new v(f.x,f.y),g=new v(e.x,e.y);var b=s*s,w=o*o,E=new d(h.x*h.x*w+h.y*h.y*b,2*(h.x*p.x*w+h.y*p.y*b),2*(h.x*m.x*w+h.y*m.y*b)+p.x*p.x*w+p.y*p.y*b,2*h.x*w*(g.x-i.x)+2*h.y*b*(g.y-i.y)+2*(p.x*m.x*w+p.y*m.y*b),2*p.x*w*(g.x-i.x)+2*p.y*b*(g.y-i.y)+m.x*m.x*w+m.y*m.y*b,2*m.x*w*(g.x-i.x)+2*m.y*b*(g.y-i.y),g.x*g.x*w-2*g.y*i.y*b-2*g.x*i.x*w+g.y*g.y*b+i.x*i.x*w+i.y*i.y*b-b*w),S=E.getRootsInInterval(0,1);for(var x=0;x<S.length;x++){var T=S[x];y.points.push(h.multiply(T*T*T).add(p.multiply(T*T).add(m.multiply(T).add(g))))}return y.points.length>0&&(y.status="Intersection"),y},c.intersectBezier3Line=function(e,t,n,r,i,s){var o,u,a,f,l,h,p,m,g,y,b=i.min(s),w=i.max(s),E=new c("No Intersection");o=e.multiply(-1),u=t.multiply(3),a=n.multiply(-3),f=o.add(u.add(a.add(r))),l=new v(f.x,f.y),o=e.multiply(3),u=t.multiply(-6),a=n.multiply(3),f=o.add(u.add(a)),h=new v(f.x,f.y),o=e.multiply(-3),u=t.multiply(3),a=o.add(u),p=new v(a.x,a.y),m=new v(e.x,e.y),y=new v(i.y-s.y,s.x-i.x),g=i.x*s.y-s.x*i.y,roots=(new d(y.dot(l),y.dot(h),y.dot(p),y.dot(m)+g)).getRoots();for(var S=0;S<roots.length;S++){var x=roots[S];if(0<=x&&x<=1){var T=e.lerp(t,x),N=t.lerp(n,x),C=n.lerp(r,x),k=T.lerp(N,x),L=N.lerp(C,x),A=k.lerp(L,x);i.x==s.x?b.y<=A.y&&A.y<=w.y&&(E.status="Intersection",E.appendPoint(A)):i.y==s.y?b.x<=A.x&&A.x<=w.x&&(E.status="Intersection",E.appendPoint(A)):A.gte(b)&&A.lte(w)&&(E.status="Intersection",E.appendPoint(A))}}return E},c.intersectBezier3Polygon=function(e,t,n,r,i){var s=new c("No Intersection"),o=i.length;for(var u=0;u<o;u++){var a=i[u],f=i[(u+1)%o],l=c.intersectBezier3Line(e,t,n,r,a,f);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},c.intersectBezier3Rectangle=function(e,t,n,r,i,s){var o=i.min(s),u=i.max(s),a=new p(u.x,o.y),f=new p(o.x,u.y),l=c.intersectBezier3Line(e,t,n,r,o,a),h=c.intersectBezier3Line(e,t,n,r,a,u),d=c.intersectBezier3Line(e,t,n,r,u,f),v=c.intersectBezier3Line(e,t,n,r,f,o),m=new c("No Intersection");return m.appendPoints(l.points),m.appendPoints(h.points),m.appendPoints(d.points),m.appendPoints(v.points),m.points.length>0&&(m.status="Intersection"),m},c.intersectCircleCircle=function(e,t,n,r){var i,s=t+r,o=Math.abs(t-r),u=e.distanceFrom(n);if(u>s)i=new c("Outside");else if(u<o)i=new c("Inside");else{i=new c("Intersection");var a=(t*t-r*r+u*u)/(2*u),f=Math.sqrt(t*t-a*a),l=e.lerp(n,a/u),h=f/u;i.points.push(new p(l.x-h*(n.y-e.y),l.y+h*(n.x-e.x))),i.points.push(new p(l.x+h*(n.y-e.y),l.y-h*(n.x-e.x)))}return i},c.intersectCircleEllipse=function(e,t,n,r,i){return c.intersectEllipseEllipse(e,t,t,n,r,i)},c.intersectCircleLine=function(e,t,n,r){var i,s=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),o=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),u=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t,a=o*o-4*s*u;if(a<0)i=new c("Outside");else if(a==0)i=new c("Tangent");else{var f=Math.sqrt(a),l=(-o+f)/(2*s),h=(-o-f)/(2*s);(l<0||l>1)&&(h<0||h>1)?l<0&&h<0||l>1&&h>1?i=new c("Outside"):i=new c("Inside"):(i=new c("Intersection"),0<=l&&l<=1&&i.points.push(n.lerp(r,l)),0<=h&&h<=1&&i.points.push(n.lerp(r,h)))}return i},c.intersectCirclePolygon=function(e,t,n){var r=new c("No Intersection"),i=n.length,s;for(var o=0;o<i;o++){var u=n[o],a=n[(o+1)%i];s=c.intersectCircleLine(e,t,u,a),r.appendPoints(s.points)}return r.points.length>0?r.status="Intersection":r.status=s.status,r},c.intersectCircleRectangle=function(e,t,n,r){var i=n.min(r),s=n.max(r),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectCircleLine(e,t,i,o),f=c.intersectCircleLine(e,t,o,s),l=c.intersectCircleLine(e,t,s,u),h=c.intersectCircleLine(e,t,u,i),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0?d.status="Intersection":d.status=a.status,d},c.intersectEllipseEllipse=function(e,t,n,r,i,s){var o=[n*n,0,t*t,-2*n*n*e.x,-2*t*t*e.y,n*n*e.x*e.x+t*t*e.y*e.y-t*t*n*n],u=[s*s,0,i*i,-2*s*s*r.x,-2*i*i*r.y,s*s*r.x*r.x+i*i*r.y*r.y-i*i*s*s],a=c.bezout(o,u),f=a.getRoots(),l=.001,h=(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2])*l,v=(u[0]*u[0]+2*u[1]*u[1]+u[2]*u[2])*l,m=new c("No Intersection");for(var g=0;g<f.length;g++){var y=new d(o[0],o[3]+f[g]*o[1],o[5]+f[g]*(o[4]+f[g]*o[2])),b=y.getRoots();for(var w=0;w<b.length;w++){var E=(o[0]*b[w]+o[1]*f[g]+o[3])*b[w]+(o[2]*f[g]+o[4])*f[g]+o[5];Math.abs(E)<h&&(E=(u[0]*b[w]+u[1]*f[g]+u[3])*b[w]+(u[2]*f[g]+u[4])*f[g]+u[5],Math.abs(E)<v&&m.appendPoint(new p(b[w],f[g])))}}return m.points.length>0&&(m.status="Intersection"),m},c.intersectEllipseLine=function(e,t,n,r,i){var s,o=new v(r.x,r.y),u=v.fromPoints(r,i),a=new v(e.x,e.y),f=o.subtract(a),l=new v(u.x/(t*t),u.y/(n*n)),h=new v(f.x/(t*t),f.y/(n*n)),p=u.dot(l),d=u.dot(h),e=f.dot(h)-1,m=d*d-p*e;if(m<0)s=new c("Outside");else if(m>0){var g=Math.sqrt(m),y=(-d-g)/p,b=(-d+g)/p;(y<0||1<y)&&(b<0||1<b)?y<0&&b<0||y>1&&b>1?s=new c("Outside"):s=new c("Inside"):(s=new c("Intersection"),0<=y&&y<=1&&s.appendPoint(r.lerp(i,y)),0<=b&&b<=1&&s.appendPoint(r.lerp(i,b)))}else{var w=-d/p;0<=w&&w<=1?(s=new c("Intersection"),s.appendPoint(r.lerp(i,w))):s=new c("Outside")}return s},c.intersectEllipsePolygon=function(e,t,n,r){var i=new c("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=c.intersectEllipseLine(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},c.intersectEllipseRectangle=function(e,t,n,r,i){var s=r.min(i),o=r.max(i),u=new p(o.x,s.y),a=new p(s.x,o.y),f=c.intersectEllipseLine(e,t,n,s,u),l=c.intersectEllipseLine(e,t,n,u,o),h=c.intersectEllipseLine(e,t,n,o,a),d=c.intersectEllipseLine(e,t,n,a,s),v=new c("No Intersection");return v.appendPoints(f.points),v.appendPoints(l.points),v.appendPoints(h.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v},c.intersectLineLine=function(e,t,n,r){var i,s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!=0){var a=s/u,f=o/u;0<=a&&a<=1&&0<=f&&f<=1?(i=new c("Intersection"),i.points.push(new p(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)))):i=new c("No Intersection")}else s==0||o==0?i=new c("Coincident"):i=new c("Parallel");return i},c.intersectLinePolygon=function(e,t,n){var r=new c("No Intersection"),i=n.length;for(var s=0;s<i;s++){var o=n[s],u=n[(s+1)%i],a=c.intersectLineLine(e,t,o,u);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},c.intersectLineRectangle=function(e,t,n,r){var i=n.min(r),s=n.max(r),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectLineLine(i,o,e,t),f=c.intersectLineLine(o,s,e,t),l=c.intersectLineLine(s,u,e,t),h=c.intersectLineLine(u,i,e,t),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},c.intersectPolygonPolygon=function(e,t){var n=new c("No Intersection"),r=e.length;for(var i=0;i<r;i++){var s=e[i],o=e[(i+1)%r],u=c.intersectLinePolygon(s,o,t);n.appendPoints(u.points)}return n.points.length>0&&(n.status="Intersection"),n},c.intersectPolygonRectangle=function(e,t,n){var r=t.min(n),i=t.max(n),s=new p(i.x,r.y),o=new p(r.x,i.y),u=c.intersectLinePolygon(r,s,e),a=c.intersectLinePolygon(s,i,e),f=c.intersectLinePolygon(i,o,e),l=c.intersectLinePolygon(o,r,e),h=new c("No Intersection");return h.appendPoints(u.points),h.appendPoints(a.points),h.appendPoints(f.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},c.intersectRayRay=function(e,t,n,r){var i,s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!=0){var a=s/u;i=new c("Intersection"),i.points.push(new p(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)))}else s==0||o==0?i=new c("Coincident"):i=new c("Parallel");return i},c.intersectRectangleRectangle=function(e,t,n,r){var i=e.min(t),s=e.max(t),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectLineRectangle(i,o,n,r),f=c.intersectLineRectangle(o,s,n,r),l=c.intersectLineRectangle(s,u,n,r),h=c.intersectLineRectangle(u,i,n,r),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},c.bezout=function(e,t){var n=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],i=e[0]*t[3]-t[0]*e[3],s=e[0]*t[4]-t[0]*e[4],o=e[0]*t[5]-t[0]*e[5],u=e[1]*t[2]-t[1]*e[2],a=e[1]*t[4]-t[1]*e[4],f=e[1]*t[5]-t[1]*e[5],l=e[2]*t[3]-t[2]*e[3],c=e[3]*t[4]-t[3]*e[4],h=e[3]*t[5]-t[3]*e[5],p=f+c,v=a-l;return new d(n*u-r*r,n*v+i*u-2*r*s,n*p+i*v-s*s-2*r*o,n*h+i*p-2*s*o,i*h-o*o)},h.prototype.init=function(e,t){this.name=e,this.params=t},p.prototype.init=function(e,t){this.x=e,this.y=t},p.prototype.add=function(e){return new p(this.x+e.x,this.y+e.y)},p.prototype.addEquals=function(e){return this.x+=e.x,this.y+=e.y,this},p.prototype.scalarAdd=function(e){return new p(this.x+e,this.y+e)},p.prototype.scalarAddEquals=function(e){return this.x+=e,this.y+=e,this},p.prototype.subtract=function(e){return new p(this.x-e.x,this.y-e.y)},p.prototype.subtractEquals=function(e){return this.x-=e.x,this.y-=e.y,this},p.prototype.scalarSubtract=function(e){return new p(this.x-e,this.y-e)},p.prototype.scalarSubtractEquals=function(e){return this.x-=e,this.y-=e,this},p.prototype.multiply=function(e){return new p(this.x*e,this.y*e)},p.prototype.multiplyEquals=function(e){return this.x*=e,this.y*=e,this},p.prototype.divide=function(e){return new p(this.x/e,this.y/e)},p.prototype.divideEquals=function(e){return this.x/=e,this.y/=e,this},p.prototype.eq=function(e){return this.x==e.x&&this.y==e.y},p.prototype.lt=function(e){return this.x<e.x&&this.y<e.y},p.prototype.lte=function(e){return this.x<=e.x&&this.y<=e.y},p.prototype.gt=function(e){return this.x>e.x&&this.y>e.y},p.prototype.gte=function(e){return this.x>=e.x&&this.y>=e.y},p.prototype.lerp=function(e,t){return new p(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},p.prototype.distanceFrom=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},p.prototype.min=function(e){return new p(Math.min(this.x,e.x),Math.min(this.y,e.y))},p.prototype.max=function(e){return new p(Math.max(this.x,e.x),Math.max(this.y,e.y))},p.prototype.toString=function(){return this.x+","+this.y},p.prototype.setXY=function(e,t){this.x=e,this.y=t},p.prototype.setFromPoint=function(e){this.x=e.x,this.y=e.y},p.prototype.swap=function(e){var t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n},d.TOLERANCE=1e-6,d.ACCURACY=6,d.prototype.init=function(e){this.coefs=new Array;for(var t=e.length-1;t>=0;t--)this.coefs.push(e[t])},d.prototype.eval=function(e){var t=0;for(var n=this.coefs.length-1;n>=0;n--)t=t*e+this.coefs[n];return t},d.prototype.multiply=function(e){var t=new d;for(var n=0;n<=this.getDegree()+e.getDegree();n++)t.coefs.push(0);for(var n=0;n<=this.getDegree();n++)for(var r=0;r<=e.getDegree();r++)t.coefs[n+r]+=this.coefs[n]*e.coefs[r];return t},d.prototype.divide_scalar=function(e){for(var t=0;t<this.coefs.length;t++)this.coefs[t]/=e},d.prototype.simplify=function(){for(var e=this.getDegree();e>=0;e--){if(!(Math.abs(this.coefs[e])<=d.TOLERANCE))break;this.coefs.pop()}},d.prototype.bisection=function(e,t){var n=this.eval(e),r=this.eval(t),i;if(Math.abs(n)<=d.TOLERANCE)i=e;else if(Math.abs(r)<=d.TOLERANCE)i=t;else if(n*r<=0){var s=Math.log(t-e),o=Math.log(10)*d.ACCURACY,u=Math.ceil((s+o)/Math.log(2));for(var a=0;a<u;a++){i=.5*(e+t);var f=this.eval(i);if(Math.abs(f)<=d.TOLERANCE)break;f*n<0?(t=i,r=f):(e=i,n=f)}}return i},d.prototype.toString=function(){var e=new Array,t=new Array;for(var n=this.coefs.length-1;n>=0;n--){var r=this.coefs[n];if(r!=0){var i=r<0?" - ":" + ";r=Math.abs(r),n>0&&(r==1?r="x":r+="x"),n>1&&(r+="^"+n),t.push(i),e.push(r)}}t[0]=t[0]==" + "?"":"-";var s="";for(var n=0;n<e.length;n++)s+=t[n]+e[n];return s},d.prototype.getDegree=function(){return this.coefs.length-1},d.prototype.getDerivative=function(){var e=new d;for(var t=1;t<this.coefs.length;t++)e.coefs.push(t*this.coefs[t]);return e},d.prototype.getRoots=function(){var e;this.simplify();switch(this.getDegree()){case 0:e=new Array;break;case 1:e=this.getLinearRoot();break;case 2:e=this.getQuadraticRoots();break;case 3:e=this.getCubicRoots();break;case 4:e=this.getQuarticRoots();break;default:e=new Array}return e},d.prototype.getRootsInInterval=function(e,t){var n=new Array,r;if(this.getDegree()==1)r=this.bisection(e,t),r!=null&&n.push(r);else{var s=this.getDerivative(),o=s.getRootsInInterval(e,t);if(o.length>0){r=this.bisection(e,o[0]),r!=null&&n.push(r);for(i=0;i<=o.length-2;i++)r=this.bisection(o[i],o[i+1]),r!=null&&n.push(r);r=this.bisection(o[o.length-1],t),r!=null&&n.push(r)}else r=this.bisection(e,t),r!=null&&n.push(r)}return n},d.prototype.getLinearRoot=function(){var e=new Array,t=this.coefs[1];return t!=0&&e.push(-this.coefs[0]/t),e},d.prototype.getQuadraticRoots=function(){var e=new Array;if(this.getDegree()==2){var t=this.coefs[2],n=this.coefs[1]/t,r=this.coefs[0]/t,i=n*n-4*r;if(i>0){var s=Math.sqrt(i);e.push(.5*(-n+s)),e.push(.5*(-n-s))}else i==0&&e.push(.5*-n)}return e},d.prototype.getCubicRoots=function(){var e=new Array;if(this.getDegree()==3){var t=this.coefs[3],n=this.coefs[2]/t,r=this.coefs[1]/t,i=this.coefs[0]/t,s=(3*r-n*n)/3,o=(2*n*n*n-9*r*n+27*i)/27,u=n/3,a=o*o/4+s*s*s/27,f=o/2;Math.abs(a)<=d.TOLERANCE&&(disrim=0);if(a>0){var l=Math.sqrt(a),c,h;c=-f+l,c>=0?h=Math.pow(c,1/3):h=-Math.pow(-c,1/3),c=-f-l,c>=0?h+=Math.pow(c,1/3):h-=Math.pow(-c,1/3),e.push(h-u)}else if(a<0){var p=Math.sqrt(-s/3),v=Math.atan2(Math.sqrt(-a),-f)/3,m=Math.cos(v),g=Math.sin(v),y=Math.sqrt(3);e.push(2*p*m-u),e.push(-p*(m+y*g)-u),e.push(-p*(m-y*g)-u)}else{var c;f>=0?c=-Math.pow(f,1/3):c=Math.pow(-f,1/3),e.push(2*c-u),e.push(-c-u)}}return e},d.prototype.getQuarticRoots=function(){var e=new Array;if(this.getDegree()==4){var t=this.coefs[4],n=this.coefs[3]/t,r=this.coefs[2]/t,i=this.coefs[1]/t,s=this.coefs[0]/t,o=(new d(1,-r,n*i-4*s,-n*n*s+4*r*s-i*i)).getCubicRoots(),u=o[0],a=n*n/4-r+u;Math.abs(a)<=d.TOLERANCE&&(a=0);if(a>0){var f=Math.sqrt(a),l=3*n*n/4-f*f-2*r,c=(4*n*r-8*i-n*n*n)/(4*f),h=l+c,p=l-c;Math.abs(h)<=d.TOLERANCE&&(h=0),Math.abs(p)<=d.TOLERANCE&&(p=0);if(h>=0){var v=Math.sqrt(h);e.push(-n/4+(f+v)/2),e.push(-n/4+(f-v)/2)}if(p>=0){var v=Math.sqrt(p);e.push(-n/4+(v-f)/2),e.push(-n/4-(v+f)/2)}}else if(!(a<0)){var c=u*u-4*s;if(c>=-d.TOLERANCE){c<0&&(c=0),c=2*Math.sqrt(c),l=3*n*n/4-2*r;if(l+c>=d.TOLERANCE){var m=Math.sqrt(l+c);e.push(-n/4+m/2),e.push(-n/4-m/2)}if(l-c>=d.TOLERANCE){var m=Math.sqrt(l-c);e.push(-n/4+m/2),e.push(-n/4-m/2)}}}}return e},v.prototype.init=function(e,t){this.x=e,this.y=t},v.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},v.prototype.dot=function(e){return this.x*e.x+this.y*e.y},v.prototype.cross=function(e){return this.x*e.y-this.y*e.x},v.prototype.unit=function(){return this.divide(this.length())},v.prototype.unitEquals=function(){return this.divideEquals(this.length()),this},v.prototype.add=function(e){return new v(this.x+e.x,this.y+e.y)},v.prototype.addEquals=function(e){return this.x+=e.x,this.y+=e.y,this},v.prototype.subtract=function(e){return new v(this.x-e.x,this.y-e.y)},v.prototype.subtractEquals=function(e){return this.x-=e.x,this.y-=e.y,this},v.prototype.multiply=function(e){return new v(this.x*e,this.y*e)},v.prototype.multiplyEquals=function(e){return this.x*=e,this.y*=e,this},v.prototype.divide=function(e){return new v(this.x/e,this.y/e)},v.prototype.divideEquals=function(e){return this.x/=e,this.y/=e,this},v.prototype.perp=function(){return new v(-this.y,this.x)},v.fromPoints=function(e,t){return new v(t.x-e.x,t.y-e.y)},m.prototype=new u,m.prototype.constructor=m,m.superclass=u.prototype,m.prototype.init=function(e){this.svgNode=e,this.locked=!1,this.visible=!0,this.selected=!1,this.callback=null,this.lastUpdate=null},m.prototype.show=function(e){var t=e?"inline":"none";this.visible=e,this.svgNode.setAttributeNS(null,"display",t)},m.prototype.refresh=function(){},m.prototype.update=function(){this.refresh(),this.owner&&this.owner.update(this),this.callback!=null&&this.callback(this)},m.prototype.translate=function(e){},m.prototype.select=function(e){this.selected=e},m.prototype.registerHandles=function(){},m.prototype.unregisterHandles=function(){},m.prototype.selectHandles=function(e){},m.prototype.showHandles=function(e){},m.prototype.mousedown=function(e){this.locked||(e.shiftKey?this.selected?mouser.unregisterShape(this):(mouser.registerShape(this),this.showHandles(!0),this.selectHandles(!0),this.registerHandles()):this.selected?(this.selectHandles(!0),this.registerHandles()):(mouser.unregisterShapes(),mouser.registerShape(this),this.showHandles(!0),this.selectHandles(!1)))},g.prototype=new m,g.prototype.constructor=g,g.superclass=m.prototype,g.prototype.init=function(e){if(e.localName!="circle")throw new Error("Circle.init: Invalid SVG Node: "+e.localName);g.superclass.init.call(this,e);var t=parseFloat(e.getAttributeNS(null,"cx")),n=parseFloat(e.getAttributeNS(null,"cy")),r=parseFloat(e.getAttributeNS(null,"r"));this.center=new b(t,n,this),this.last=new p(t,n),this.radius=new b(t+r,n,this)},g.prototype.realize=function(){this.svgNode!=null&&(this.center.realize(),this.radius.realize(),this.center.show(!1),this.radius.show(!1),this.svgNode.addEventListener("mousedown",this,!1))},g.prototype.translate=function(e){this.center.translate(e),this.radius.translate(e),this.refresh()},g.prototype.refresh=function(){var e=this.radius.point.distanceFrom(this.center.point);this.svgNode.setAttributeNS(null,"cx",this.center.point.x),this.svgNode.setAttributeNS(null,"cy",this.center.point.y),this.svgNode.setAttributeNS(null,"r",e)},g.prototype.registerHandles=function(){mouser.register(this.center),mouser.register(this.radius)},g.prototype.unregisterHandles=function(){mouser.unregister(this.center),mouser.unregister(this.radius)},g.prototype.selectHandles=function(e){this.center.select(e),this.radius.select(e)},g.prototype.showHandles=function(e){this.center.show(e),this.radius.show(e)},g.prototype.getIntersectionParams=function(){return new h("Circle",[this.center.point,parseFloat(this.svgNode.getAttributeNS(null,"r"))])},y.prototype=new m,y.prototype.constructor=y,y.superclass=m.prototype,y.prototype.init=function(e){if(e==null||e.localName!="ellipse")throw new Error("Ellipse.init: Invalid localName: "+e.localName);y.superclass.init.call(this,e);var t=parseFloat(e.getAttributeNS(null,"cx")),n=parseFloat(e.getAttributeNS(null,"cy")),r=parseFloat(e.getAttributeNS(null,"rx")),i=parseFloat(e.getAttributeNS(null,"ry"));this.center=new b(t,n,this),this.radiusX=new b(t+r,n,this),this.radiusY=new b(t,n+i,this)},y.prototype.realize=function(){this.center.realize(),this.radiusX.realize(),this.radiusY.realize(),this.center.show(!1),this.radiusX.show(!1),this.radiusY.show(!1),this.svgNode.addEventListener("mousedown",this,!1)},y.prototype.refresh=function(){var e=Math.abs(this.center.point.x-this.radiusX.point.x),t=Math.abs(this.center.point.y-this.radiusY.point.y);this.svgNode.setAttributeNS(null,"cx",this.center.point.x),this.svgNode.setAttributeNS(null,"cy",this.center.point.y),this.svgNode.setAttributeNS(null,"rx",e),this.svgNode.setAttributeNS(null,"ry",t)},y.prototype.registerHandles=function(){mouser.register(this.center),mouser.register(this.radiusX),mouser.register(this.radiusY)},y.prototype.unregisterHandles=function(){mouser.unregister(this.center),mouser.unregister(this.radiusX),mouser.unregister(this.radiusY)},y.prototype.selectHandles=function(e){this.center.select(e),this.radiusX.select(e),this.radiusY.select(e)},y.prototype.showHandles=function(e){this.center.show(e),this.radiusX.show(e),this.radiusY.show(e)},y.prototype.getIntersectionParams=function(){return new h("Ellipse",[this.center.point,parseFloat(this.svgNode.getAttributeNS(null,"rx")),parseFloat(this.svgNode.getAttributeNS(null,"ry"))])},b.prototype=new m,b.prototype.constructor=b,b.superclass=m.prototype,b.NO_CONSTRAINTS=0,b.CONSTRAIN_X=1,b.CONSTRAIN_Y=2,b.prototype.init=function(e,t,n){b.superclass.init.call(this,null),this.point=new p(e,t),this.owner=n,this.constrain=b.NO_CONSTRAINTS},b.prototype.realize=function(){if(this.svgNode==null){var e="http://www.w3.org/2000/svg",t=svgDocument.createElementNS(e,"rect"),n;this.owner!=null&&this.owner.svgNode!=null?n=this.owner.svgNode.parentNode:n=svgDocument.documentElement,t.setAttributeNS(null,"x",this.point.x-2),t.setAttributeNS(null,"y",this.point.y-2),t.setAttributeNS(null,"width",4),t.setAttributeNS(null,"height",4),t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"fill","white"),t.addEventListener("mousedown",this,!1),n.appendChild(t),this.svgNode=t,this.show(this.visible)}},b.prototype.unrealize=function(){this.svgNode.removeEventListener("mousedown",this,!1),this.svgNode.parentNode.removeChild(this.svgNode)},b.prototype.translate=function(e){this.constrain==b.CONSTRAIN_X?this.point.x+=e.x:this.constrain==b.CONSTRAIN_Y?this.point.y+=e.y:this.point.addEquals(e),this.refresh()},b.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x",this.point.x-2),this.svgNode.setAttributeNS(null,"y",this.point.y-2)},b.prototype.select=function(e){b.superclass.select.call(this,e),e?this.svgNode.setAttributeNS(null,"fill","black"):this.svgNode.setAttributeNS(null,"fill","white")},b.prototype.mousedown=function(e){if(!this.locked)if(e.shiftKey)this.selected?mouser.unregister(this):(mouser.register(this),mouser.beginDrag(e));else{if(!this.selected){var t=this.owner;mouser.unregisterAll(),mouser.register(this)}mouser.beginDrag(e)}},w.prototype=new m,w.prototype.constructor=w,w.superclass=m.prototype,w.prototype.init=function(e,t,n,r,i){w.superclass.init.call(this,null),this.point=new b(e,t,this),this.lever=new E(n,r,this),this.owner=i},w.prototype.realize=function(){if(this.svgNode==null){var e="http://www.w3.org/2000/svg",t=svgDocument.createElementNS(e,"line"),n;this.owner!=null&&this.owner.svgNode!=null?n=this.owner.svgNode.parentNode:n=svgDocument.documentElement,t.setAttributeNS(null,"x1",this.point.point.x),t.setAttributeNS(null,"y1",this.point.point.y),t.setAttributeNS(null,"x2",this.lever.point.x),t.setAttributeNS(null,"y2",this.lever.point.y),t.setAttributeNS(null,"stroke","black"),n.appendChild(t),this.svgNode=t,this.point.realize(),this.lever.realize(),this.show(this.visible)}},w.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x1",this.point.point.x),this.svgNode.setAttributeNS(null,"y1",this.point.point.y),this.svgNode.setAttributeNS(null,"x2",this.lever.point.x),this.svgNode.setAttributeNS(null,"y2",this.lever.point.y)},E.prototype=new b,E.prototype.constructor=E,E.superclass=b.prototype,E.prototype.realize=function(){if(this.svgNode==null){var e="http://www.w3.org/2000/svg",t=svgDocument.createElementNS(e,"circle"),n;this.owner!=null&&this.owner.svgNode!=null?n=this.owner.svgNode.parentNode:n=svgDocument.documentElement,t.setAttributeNS(null,"cx",this.point.x),t.setAttributeNS(null,"cy",this.point.y),t.setAttributeNS(null,"r",2.5),t.setAttributeNS(null,"fill","black"),t.addEventListener("mousedown",this,!1),n.appendChild(t),this.svgNode=t,this.show(this.visible)}},E.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"cx",this.point.x),this.svgNode.setAttributeNS(null,"cy",this.point.y)},E.prototype.select=function(e){E.superclass.select.call(this,e),this.svgNode.setAttributeNS(null,"fill","black")},S.prototype=new m,S.prototype.constructor=S,S.superclass=m.prototype,S.prototype.init=function(e){if(e==null||e.localName!="line")throw new Error("Line.init: Invalid localName: "+e.localName);S.superclass.init.call(this,e);var t=parseFloat(e.getAttributeNS(null,"x1")),n=parseFloat(e.getAttributeNS(null,"y1")),r=parseFloat(e.getAttributeNS(null,"x2")),i=parseFloat(e.getAttributeNS(null,"y2"));this.p1=new b(t,n,this),this.p2=new b(r,i,this)},S.prototype.realize=function(){this.p1.realize(),this.p2.realize(),this.p1.show(!1),this.p2.show(!1),this.svgNode.addEventListener("mousedown",this,!1)},S.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x1",this.p1.point.x),this.svgNode.setAttributeNS(null,"y1",this.p1.point.y),this.svgNode.setAttributeNS(null,"x2",this.p2.point.x),this.svgNode.setAttributeNS(null,"y2",this.p2.point.y)},S.prototype.registerHandles=function(){mouser.register(this.p1),mouser.register(this.p2)},S.prototype.unregisterHandles=function(){mouser.unregister(this.p1),mouser.unregister(this.p2)},S.prototype.selectHandles=function(e){this.p1.select(e),this.p2.select(e)},S.prototype.showHandles=function(e){this.p1.show(e),this.p2.show(e)},S.prototype.cut=function(e){var t=this.p1.point.lerp(this.p2.point,e),n=this.svgNode.cloneNode(!0);this.p2.point.setFromPoint(t),this.p2.update(),this.svgNode.nextSibling!=null?this.svgNode.parentNode.insertBefore(n,this.svgNode.nextSibling):this.svgNode.parentNode.appendChild(n);var r=new S(n);r.realize(),r.p1.point.setFromPoint(t),r.p1.update()},S.prototype.getIntersectionParams=function(){return new h("Line",[this.p1.point,this.p2.point])},x.prototype.init=function(e,t){this.type=e,this.text=t},x.prototype.typeis=function(e){return this.type==e},T.prototype=new m,T.prototype.constructor=T,T.superclass=m.prototype,T.COMMAND=0,T.NUMBER=1,T.EOD=2,T.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]},T.prototype.init=function(e){if(e==null||e.localName!="path")throw new Error("Path.init: Invalid localName: "+e.localName);T.superclass.init.call(this,e),this.segments=null,this.parseData(e.getAttributeNS(null,"d"))},T.prototype.realize=function(){for(var e=0;e<this.segments.length;e++)this.segments[e].realize();this.svgNode.addEventListener("mousedown",this,!1)},T.prototype.unrealize=function(){for(var e=0;e<this.segments.length;e++)this.segments[e].unrealize();this.svgNode.removeEventListener("mousedown",this,!1)},T.prototype.refresh=function(){var e=new Array;for(var t=0;t<this.segments.length;t++)e.push(this.segments[t].toString());this.svgNode.setAttributeNS(null,"d",e.join(" "))},T.prototype.registerHandles=function(){for(var e=0;e<this.segments.length;e++)this.segments[e].registerHandles()},T.prototype.unregisterHandles=function(){for(var e=0;e<this.segments.length;e++)this.segments[e].unregisterHandles()},T.prototype.selectHandles=function(e){for(var t=0;t<this.segments.length;t++)this.segments[t].selectHandles(e)},T.prototype.showHandles=function(e){for(var t=0;t<this.segments.length;t++)this.segments[t].showHandles(e)},T.prototype.appendPathSegment=function(e){e.previous=this.segments[this.segments.length-1],this.segments.push(e)},T.prototype.parseData=function(e){var t=this.tokenize(e),n=0,r=t[n],i="BOD";this.segments=new Array;while(!r.typeis(T.EOD)){var s,o=new Array;if(i=="BOD"){if(r.text!="M"&&r.text!="m")throw new Error("Path data must begin with a moveto command");n++,s=T.PARAMS[r.text].length,i=r.text}else r.typeis(T.NUMBER)?s=T.PARAMS[i].length:(n++,s=T.PARAMS[r.text].length,i=r.text);if(!(n+s<t.length))throw new Error("Path data ended before all parameters were found");for(var u=n;u<n+s;u++){var a=t[u];if(!a.typeis(T.NUMBER))throw new Error("Parameter type is not a number: "+i+","+a.text);o[o.length]=a.text}var f,l=this.segments.length,c=l==0?null:this.segments[l-1];switch(i){case"A":f=new C(o,this,c);break;case"C":f=new L(o,this,c);break;case"c":f=new F(o,this,c);break;case"H":f=new A(o,this,c);break;case"L":f=new O(o,this,c);break;case"l":f=new I(o,this,c);break;case"M":f=new M(o,this,c);break;case"m":f=new q(o,this,c);break;case"Q":f=new k(o,this,c);break;case"q":f=new j(o,this,c);break;case"S":f=new P(o,this,c);break;case"s":f=new U(o,this,c);break;case"T":f=new D(o,this,c);break;case"t":f=new R(o,this,c);break;case"Z":f=new B(o,this,c);break;case"z":f=new B(o,this,c);break;default:throw new Error("Unsupported segment type: "+i)}this.segments.push(f),n+=s,r=t[n],i=="M"&&(i="L"),i=="m"&&(i="l")}},T.prototype.tokenize=function(e){var t=new Array;while(e!="")if(e.match(/^([ \t\r\n,]+)/))e=e.substr(RegExp.$1.length);else if(e.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]=new x(T.COMMAND,RegExp.$1),e=e.substr(RegExp.$1.length);else{if(!e.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("Unrecognized segment command: "+e);t[t.length]=new x(T.NUMBER,parseFloat(RegExp.$1)),e=e.substr(RegExp.$1.length)}return t[t.length]=new x(T.EOD,null),t},T.prototype.intersectShape=function(e){var t=new c("No Intersection");for(var n=0;n<this.segments.length;n++){var r=c.intersectShapes(this.segments[n],e);t.appendPoints(r.points)}return t.points.length>0&&(t.status="Intersection"),t},T.prototype.getIntersectionParams=function(){return new h("Path",[])},N.prototype.init=function(e,t,n,r){this.command=e,this.owner=n,this.previous=r,this.handles=new Array;var i=0;while(i<t.length){var s=new b(t[i],t[i+1],n);this.handles.push(s),i+=2}},N.prototype.realize=function(){for(var e=0;e<this.handles.length;e++){var t=this.handles[e];t.realize(),t.show(!1)}},N.prototype.unrealize=function(){for(var e=0;e<this.handles.length;e++)this.handles[e].unrealize()},N.prototype.registerHandles=function(){for(var e=0;e<this.handles.length;e++)mouser.register(this.handles[e])},N.prototype.unregisterHandles=function(){for(var e=0;e<this.handles.length;e++)mouser.unregister(this.handles[e])},N.prototype.selectHandles=function(e){for(var t=0;t<this.handles.length;t++)this.handles[t].select(e)},N.prototype.showHandles=function(e){for(var t=0;t<this.handles.length;t++)this.handles[t].show(e)},N.prototype.toString=function(){var e=new Array,t="";if(this.previous==null||this.previous.constructor!=this.constuctor)t=this.command;for(var n=0;n<this.handles.length;n++)e.push(this.handles[n].point.toString());return t+e.join(" ")},N.prototype.getLastPoint=function(){return this.handles[this.handles.length-1].point},N.prototype.getIntersectionParams=function(){return null},C.prototype=new N,C.prototype.constructor=C,C.superclass=N.prototype,C.prototype.init=function(e,t,n,r){var i=new Array,s=t.pop(),o=t.pop();i.push(o,s),C.superclass.init.call(this,e,i,n,r),this.rx=parseFloat(t.shift()),this.ry=parseFloat(t.shift()),this.angle=parseFloat(t.shift()),this.arcFlag=parseFloat(t.shift()),this.sweepFlag=parseFloat(t.shift())},C.prototype.toString=function(){var e=new Array,t="";return this.previous.constructor!=this.constuctor&&(t=this.command),t+[this.rx,this.ry,this.angle,this.arcFlag,this.sweepFlag,this.handles[0].point.toString()].join(",")},C.prototype.getIntersectionParams=function(){return new h("Ellipse",[this.getCenter(),this.rx,this.ry])},C.prototype.getCenter=function(){var e=this.previous.getLastPoint(),t=this.handles[0].point,n=this.rx,r=this.ry,i=this.angle*Math.PI/180,s=Math.cos(i),o=Math.sin(i),u=1e-6,a=e.subtract(t).divide(2),f=a.x*s+a.y*o,l=a.x*-o+a.y*s,c=f*f,h=l*l,d=c/(n*n)+h/(r*r);if(d>1){var v=Math.sqrt(d);n*=v,r*=v}var m=n*n,g=r*r,y=m*h,b=g*c,v=(m*g-y-b)/(y+b);Math.abs(v)<u&&(v=0);var w=Math.sqrt(v);this.arcFlag==this.sweepFlag&&(w=-w);var E=e.add(t).divide(2),S=w*n*l/r,x=w*-r*f/n;return new p(S*s-x*o+E.x,S*o+x*s+E.y)},k.prototype=new N,k.prototype.constructor=k,k.superclass=N.prototype,k.prototype.getControlPoint=function(){return this.handles[0].point},k.prototype.getIntersectionParams=function(){return new h("Bezier2",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point])},L.prototype=new N,L.prototype.constructor=L,L.superclass=N.prototype,L.prototype.getLastControlPoint=function(){return this.handles[1].point},L.prototype.getIntersectionParams=function(){return new h("Bezier3",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point,this.handles[2].point])},A.prototype=new N,A.prototype.constructor=A,A.superclass=N.prototype,A.prototype.init=function(e,t,n,r){var i=r.getLastPoint(),s=new Array;s.push(t.pop(),i.y),A.superclass.init.call(this,e,s,n,r)},A.prototype.toString=function(){var e=new Array,t="";return this.previous.constructor!=this.constuctor&&(t=this.command),t+this.handles[0].point.x},O.prototype=new N,O.prototype.constructor=O,O.superclass=N.prototype,O.prototype.toString=function(){var e=new Array,t="";return this.previous.constructor!=this.constuctor&&this.previous.constructor!=M&&(t=this.command),t+this.handles[0].point.toString()},O.prototype.getIntersectionParams=function(){return new h("Line",[this.previous.getLastPoint(),this.handles[0].point])},M.prototype=new N,M.prototype.constructor=M,M.superclass=N.prototype,M.prototype.toString=function(){return"M"+this.handles[0].point.toString()},D.prototype=new N,D.prototype.constructor=D,D.superclass=N.prototype,D.prototype.getControlPoint=function(){var e=this.previous.getLastPoint(),t;if(this.previous.command.match(/^[QqTt]$/)){var n=this.previous.getControlPoint(),r=n.subtract(e);t=e.subtract(r)}else t=e;return t},D.prototype.getIntersectionParams=function(){return new h("Bezier2",[this.previous.getLastPoint(),this.getControlPoint(),this.handles[0].point])},P.prototype=new N,P.prototype.constructor=P,P.superclass=N.prototype,P.prototype.getFirstControlPoint=function(){var e=this.previous.getLastPoint(),t;if(this.previous.command.match(/^[SsCc]$/)){var n=this.previous.getLastControlPoint(),r=n.subtract(e);t=e.subtract(r)}else t=e;return t},P.prototype.getLastControlPoint=function(){return this.handles[0].point},P.prototype.getIntersectionParams=function(){return new h("Bezier3",[this.previous.getLastPoint(),this.getFirstControlPoint(),this.handles[0].point,this.handles[1].point])},H.prototype=new N,H.prototype.constructor=H,H.superclass=N.prototype,H.prototype.init=function(e,t,n,r){this.command=e,this.owner=n,this.previous=r,this.handles=new Array;var i;this.previous?i=this.previous.getLastPoint():i=new p(0,0);var s=0;while(s<t.length){var o=new b(i.x+t[s],i.y+t[s+1],n);this.handles.push(o),s+=2}},H.prototype.toString=function(){var e=new Array,t="",n;this.previous?n=this.previous.getLastPoint():n=new p(0,0);if(this.previous==null||this.previous.constructor!=this.constructor)t=this.command;for(var r=0;r<this.handles.length;r++){var i=this.handles[r].point.subtract(n);e.push(i.toString())}return t+e.join(" ")},B.prototype=new H,B.prototype.constructor=B,B.superclass=H.prototype,B.prototype.getLastPoint=function(){var e=this.previous,t;while(e){if(e.command.match(/^[mMzZ]$/)){t=e.getLastPoint();break}e=e.previous}return t},B.prototype.getIntersectionParams=function(){return new h("Line",[this.previous.getLastPoint(),this.getLastPoint()])},j.prototype=new H,j.prototype.constructor=j,j.superclass=H.prototype,j.prototype.getControlPoint=function(){return this.handles[0].point},j.prototype.getIntersectionParams=function(){return new h("Bezier2",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point])},F.prototype=new H,F.prototype.constructor=F,F.superclass=H.prototype,F.prototype.getLastControlPoint=function(){return this.handles[1].point},F.prototype.getIntersectionParams=function(){return new h("Bezier3",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point,this.handles[2].point])},I.prototype=new H,I.prototype.constructor=I,I.superclass=H.prototype,I.prototype.toString=function(){var e=new Array,t="",n,r;return this.previous?n=this.previous.getLastPoint():n=new Point(0,0),r=this.handles[0].point.subtract(n),this.previous.constructor!=this.constuctor&&this.previous.constructor!=q&&(cmd=this.command),cmd+r.toString()},I.prototype.getIntersectionParams=function(){return new h("Line",[this.previous.getLastPoint(),this.handles[0].point])},q.prototype=new H,q.prototype.constructor=q,q.superclass=H.prototype,q.prototype.toString=function(){return"m"+this.handles[0].point.toString()},R.prototype=new H,R.prototype.constructor=R,R.superclass=H.prototype,R.prototype.getControlPoint=function(){var e=this.previous.getLastPoint(),t;if(this.previous.command.match(/^[QqTt]$/)){var n=this.previous.getControlPoint(),r=n.subtract(e);t=e.subtract(r)}else t=e;return t},R.prototype.getIntersectionParams=function(){return new h("Bezier2",[this.previous.getLastPoint(),this.getControlPoint(),this.handles[0].point])},U.prototype=new H,U.prototype.constructor=U,U.superclass=H.prototype,U.prototype.getFirstControlPoint=function(){var e=this.previous.getLastPoint(),t;if(this.previous.command.match(/^[SsCc]$/)){var n=this.previous.getLastControlPoint(),r=n.subtract(e);t=e.subtract(r)}else t=e;return t},U.prototype.getLastControlPoint=function(){return this.handles[0].point},U.prototype.getIntersectionParams=function(){return new h("Bezier3",[this.previous.getLastPoint(),this.getFirstControlPoint(),this.handles[0].point,this.handles[1].point])},z.prototype=new m,z.prototype.constructor=z,z.superclass=m.prototype,z.prototype.init=function(e){if(e.localName!="polygon")throw new Error("Polygon.init: Invalid SVG Node: "+e.localName);z.superclass.init.call(this,e);var t=e.getAttributeNS(null,"points").split(/[\s,]+/);this.handles=new Array;for(var n=0;n<t.length;n+=2){var r=parseFloat(t[n]),i=parseFloat(t[n+1]);this.handles.push(new b(r,i,this))}},z.prototype.realize=function(){if(this.svgNode!=null){for(var e=0;e<this.handles.length;e++)this.handles[e].realize(),this.handles[e].show(!1);this.svgNode.addEventListener("mousedown",this,!1)}},z.prototype.refresh=function(){var e=new Array;for(var t=0;t<this.handles.length;t++)e.push(this.handles[t].point.toString());this.svgNode.setAttributeNS(null,"points",e.join(" "))},z.prototype.registerHandles=function(){for(var e=0;e<this.handles.length;e++)mouser.register(this.handles[e])},z.prototype.unregisterHandles=function(){for(var e=0;e<this.handles.length;e++)mouser.unregister(this.handles[e])},z.prototype.selectHandles=function(e){for(var t=0;t<this.handles.length;t++)this.handles[t].select(e)},z.prototype.showHandles=function(e){for(var t=0;t<this.handles.length;t++)this.handles[t].show(e)},z.prototype.pointInPolygon=function(e){var t=this.handles.length,n=0,r,i=this.handles[0].point;for(var s=1;s<=t;s++){var o=this.handles[s%t].point;e.y>Math.min(i.y,o.y)&&e.y<=Math.max(i.y,o.y)&&e.x<=Math.max(i.x,o.x)&&i.y!=o.y&&(r=(e.y-i.y)*(o.x-i.x)/(o.y-i.y)+i.x,(i.x==o.x||e.x<=r)&&n++),i=o}return n%2==1},z.prototype.getIntersectionParams=function(){var e=new Array;for(var t=0;t<this.handles.length;t++)e.push(this.handles[t].point);return new h("Polygon",[e])},z.prototype.getArea=function(){var e=0,t=this.handles.length,n=0,r=0;for(var i=0;i<t;i++){var s=this.handles[i].point,o=this.handles[(i+1)%t].point;e+=s.x*o.y-o.x*s.y}return e/2},z.prototype.getCentroid=function(){var e=this.handles.length,t=6*this.getArea(),n=0,r=0;for(var i=0;i<e;i++){var s=this.handles[i].point,o=this.handles[(i+1)%e].point,u=s.x*o.y-o.x*s.y;n+=(s.x+o.x)*u,r+=(s.y+o.y)*u}return new p(n/t,r/t)},z.prototype.isClockwise=function(){return this.getArea()<0},z.prototype.isCounterClockwise=function(){return this.getArea()>0},z.prototype.isConcave=function(){var e=0,t=0,n=this.handles.length;for(var r=0;r<n;r++){var i=this.handles[r].point,s=this.handles[(r+1)%n].point,o=this.handles[(r+2)%n].point,u=v.fromPoints(i,s),a=v.fromPoints(s,o),f=u.cross(a);f<0?t++:e++}return t!=0&&e!=0},z.prototype.isConvex=function(){return!this.isConcave()},W.prototype=new m,W.prototype.constructor=W,W.superclass=m.prototype,W.prototype.init=function(e){if(e.localName!="rect")throw new Error("Rectangle.init: Invalid SVG Node: "+e.localName);W.superclass.init.call(this,e);var t=parseFloat(e.getAttributeNS(null,"x")),n=parseFloat(e.getAttributeNS(null,"y")),r=parseFloat(e.getAttributeNS(null,"width")),i=parseFloat(e.getAttributeNS(null,"height"));this.p1=new b(t,n,this),this.p2=new b(t+r,n+i,this)},W.prototype.realize=function(){this.svgNode!=null&&(this.p1.realize(),this.p2.realize(),this.p1.show(!1),this.p2.show(!1),this.svgNode.addEventListener("mousedown",this,!1))},W.prototype.refresh=function(){var e=this.p1.point.min(this.p2.point),t=this.p1.point.max(this.p2.point);this.svgNode.setAttributeNS(null,"x",e.x),this.svgNode.setAttributeNS(null,"y",e.y),this.svgNode.setAttributeNS(null,"width",t.x-e.x),this.svgNode.setAttributeNS(null,"height",t.y-e.y)},W.prototype.registerHandles=function(){mouser.register(this.p1),mouser.register(this.p2)},W.prototype.unregisterHandles=function(){mouser.unregister(this.p1),mouser.unregister(this.p2)},W.prototype.selectHandles=function(e){this.p1.select(e),this.p2.select(e)},W.prototype.showHandles=function(e){this.p1.show(e),this.p2.show(e)},W.prototype.getIntersectionParams=function(){return new h("Rectangle",[this.p1.point,this.p2.point])},c.prototype.init=function(e){this.status=e,this.points=new Array},c.prototype.appendPoint=function(e){this.points.push(e)},c.prototype.appendPoints=function(e){this.points=this.points.concat(e)},c.intersectShapes=function(e,t){var n=e.getIntersectionParams(),r=t.getIntersectionParams(),i;if(n!=null&&r!=null)if(n.name=="Path")i=c.intersectPathShape(e,t);else if(r.name=="Path")i=c.intersectPathShape(t,e);else{var s,o;n.name<r.name?(s="intersect"+n.name+r.name,o=n.params.concat(r.params)):(s="intersect"+r.name+n.name,o=r.params.concat(n.params));if(!(s in c))throw new Error("Intersection not available: "+s);i=c[s].apply(null,o)}else i=new c("No Intersection");return i},c.intersectPathShape=function(e,t){return e.intersectShape(t)},c.intersectBezier2Bezier2=function(e,t,n,r,i,s){var o,u,a,f,l,h,v,m,g=new c("No Intersection"),y;o=t.multiply(-2),a=e.add(o.add(n)),o=e.multiply(-2),u=t.multiply(2),f=o.add(u),l=new p(e.x,e.y),o=i.multiply(-2),h=r.add(o.add(s)),o=r.multiply(-2),u=i.multiply(2),v=o.add(u),m=new p(r.x,r.y);if(a.y==0){var b=a.x*(l.y-m.y),w=b-f.x*f.y,E=b+w,S=f.y*f.y;y=new d(a.x*h.y*h.y,2*a.x*v.y*h.y,a.x*v.y*v.y-h.x*S-h.y*b-h.y*w,-v.x*S-v.y*b-v.y*w,(l.x-m.x)*S+(l.y-m.y)*w)}else{var b=a.x*h.y-a.y*h.x,w=a.x*v.y-v.x*a.y,E=f.x*a.y-f.y*a.x,S=l.y-m.y,x=a.y*(l.x-m.x)-a.x*S,T=-f.y*E+a.y*x,N=E*E;y=new d(b*b,2*b*w,(-h.y*N+a.y*w*w+a.y*b*x+b*T)/a.y,(-v.y*N+a.y*w*x+w*T)/a.y,(S*N+x*T)/a.y)}var C=y.getRoots();for(var k=0;k<C.length;k++){var L=C[k];if(0<=L&&L<=1){var A=(new d(a.x,f.x,l.x-m.x-L*v.x-L*L*h.x)).getRoots(),O=(new d(a.y,f.y,l.y-m.y-L*v.y-L*L*h.y)).getRoots();if(A.length>0&&O.length>0){var M=1e-4;e:for(var _=0;_<A.length;_++){var D=A[_];if(0<=D&&D<=1)for(var P=0;P<O.length;P++)if(Math.abs(D-O[P])<M){g.points.push(h.multiply(L*L).add(v.multiply(L).add(m)));break e}}}}}return g.points.length>0&&(g.status="Intersection"),g},c.intersectBezier2Bezier3=function(e,t,n,r,i,s,o){var u,a,f,l,h,m,g,y,b,w,E,S=new c("No Intersection");u=t.multiply(-2),h=e.add(u.add(n)),u=e.multiply(-2),a=t.multiply(2),m=u.add(a),g=new p(e.x,e.y),u=r.multiply(-1),a=i.multiply(3),f=s.multiply(-3),l=u.add(a.add(f.add(o))),y=new v(l.x,l.y),u=r.multiply(3),a=i.multiply(-6),f=s.multiply(3),l=u.add(a.add(f)),b=new v(l.x,l.y),u=r.multiply(-3),a=i.multiply(3),f=u.add(a),w=new v(f.x,f.y),E=new v(r.x,r.y);var x=g.x*g.x,T=g.y*g.y,N=m.x*m.x,C=m.y*m.y,k=h.x*h.x,L=h.y*h.y,A=E.x*E.x,O=E.y*E.y,M=w.x*w.x,_=w.y*w.y,D=b.x*b.x,P=b.y*b.y,H=y.x*y.x,B=y.y*y.y,j=new d(-2*h.x*h.y*y.x*y.y+k*B+L*H,-2*h.x*h.y*b.x*y.y-2*h.x*h.y*b.y*y.x+2*L*b.x*y.x+2*k*b.y*y.y,-2*h.x*w.x*h.y*y.y-2*h.x*h.y*w.y*y.x-2*h.x*h.y*b.x*b.y+2*w.x*L*y.x+L*D+k*(2*w.y*y.y+P),2*g.x*h.x*h.y*y.y+2*g.y*h.x*h.y*y.x+m.x*m.y*h.x*y.y+m.x*m.y*h.y*y.x-2*E.x*h.x*h.y*y.y-2*h.x*E.y*h.y*y.x-2*h.x*w.x*h.y*b.y-2*h.x*h.y*w.y*b.x-2*g.x*L*y.x-2*g.y*k*y.y+2*E.x*L*y.x+2*w.x*L*b.x-C*h.x*y.x-N*h.y*y.y+k*(2*E.y*y.y+2*w.y*b.y),2*g.x*h.x*h.y*b.y+2*g.y*h.x*h.y*b.x+m.x*m.y*h.x*b.y+m.x*m.y*h.y*b.x-2*E.x*h.x*h.y*b.y-2*h.x*E.y*h.y*b.x-2*h.x*w.x*h.y*w.y-2*g.x*L*b.x-2*g.y*k*b.y+2*E.x*L*b.x-C*h.x*b.x-N*h.y*b.y+M*L+k*(2*E.y*b.y+_),2*g.x*h.x*h.y*w.y+2*g.y*h.x*w.x*h.y+m.x*m.y*h.x*w.y+m.x*m.y*w.x*h.y-2*E.x*h.x*h.y*w.y-2*h.x*E.y*w.x*h.y-2*g.x*w.x*L-2*g.y*k*w.y+2*E.x*w.x*L-C*h.x*w.x-N*h.y*w.y+2*k*E.y*w.y,-2*g.x*g.y*h.x*h.y-g.x*m.x*m.y*h.y-g.y*m.x*m.y*h.x+2*g.x*h.x*E.y*h.y+2*g.y*E.x*h.x*h.y+m.x*E.x*m.y*h.y+m.x*m.y*h.x*E.y-2*E.x*h.x*E.y*h.y-2*g.x*E.x*L+g.x*C*h.x+g.y*N*h.y-2*g.y*k*E.y-E.x*C*h.x-N*E.y*h.y+x*L+T*k+A*L+k*O),F=j.getRootsInInterval(0,1);for(var I=0;I<F.length;I++){var q=F[I],R=(new d(h.x,m.x,g.x-E.x-q*w.x-q*q*b.x-q*q*q*y.x)).getRoots(),U=(new d(h.y,m.y,g.y-E.y-q*w.y-q*q*b.y-q*q*q*y.y)).getRoots();if(R.length>0&&U.length>0){var z=1e-4;e:for(var W=0;W<R.length;W++){var X=R[W];if(0<=X&&X<=1)for(var V=0;V<U.length;V++)if(Math.abs(X-U[V])<z){S.points.push(y.multiply(q*q*q).add(b.multiply(q*q).add(w.multiply(q).add(E))));break e}}}}return S.points.length>0&&(S.status="Intersection"),S},c.intersectBezier2Circle=function(e,t,n,r,i){return c.intersectBezier2Ellipse(e,t,n,r,i,i)},c.intersectBezier2Ellipse=function(e,t,n,r,i,s){var o,u,a,f,l,h=new c("No Intersection");o=t.multiply(-2),a=e.add(o.add(n)),o=e.multiply(-2),u=t.multiply(2),f=o.add(u),l=new p(e.x,e.y);var v=i*i,m=s*s,g=(new d(m*a.x*a.x+v*a.y*a.y,2*(m*a.x*f.x+v*a.y*f.y),m*(2*a.x*l.x+f.x*f.x)+v*(2*a.y*l.y+f.y*f.y)-2*(m*r.x*a.x+v*r.y*a.y),2*(m*f.x*(l.x-r.x)+v*f.y*(l.y-r.y)),m*(l.x*l.x+r.x*r.x)+v*(l.y*l.y+r.y*r.y)-2*(m*r.x*l.x+v*r.y*l.y)-v*m)).getRoots();for(var y=0;y<g.length;y++){var b=g[y];0<=b&&b<=1&&h.points.push(a.multiply(b*b).add(f.multiply(b).add(l)))}return h.points.length>0&&(h.status="Intersection"),h},c.intersectBezier2Line=function(e,t,n,r,i){var s,o,u,a,f,l,h,m=r.min(i),g=r.max(i),y=new c("No Intersection");s=t.multiply(-2),u=e.add(s.add(n)),s=e.multiply(-2),o=t.multiply(2),a=s.add(o),f=new p(e.x,e.y),h=new v(r.y-i.y,i.x-r.x),l=r.x*i.y-i.x*r.y,roots=(new d(h.dot(u),h.dot(a),h.dot(f)+l)).getRoots();for(var b=0;b<roots.length;b++){var w=roots[b];if(0<=w&&w<=1){var E=e.lerp(t,w),S=t.lerp(n,w),x=E.lerp(S,w);r.x==i.x?m.y<=x.y&&x.y<=g.y&&(y.status="Intersection",y.appendPoint(x)):r.y==i.y?m.x<=x.x&&x.x<=g.x&&(y.status="Intersection",y.appendPoint(x)):x.gte(m)&&x.lte(g)&&(y.status="Intersection",y.appendPoint(x))}}return y},c.intersectBezier2Polygon=function(e,t,n,r){var i=new c("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=c.intersectBezier2Line(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},c.intersectBezier2Rectangle=function(e,t,n,r,i){var s=r.min(i),o=r.max(i),u=new p(o.x,s.y),a=new p(s.x,o.y),f=c.intersectBezier2Line(e,t,n,s,u),l=c.intersectBezier2Line(e,t,n,u,o),h=c.intersectBezier2Line(e,t,n,o,a),d=c.intersectBezier2Line(e,t,n,a,s),v=new c("No Intersection");return v.appendPoints(f.points),v.appendPoints(l.points),v.appendPoints(h.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v},c.intersectBezier3Bezier3=function(e,t,n,r,i,s,o,u){var a,f,l,h,p,m,g,y,b,w,E,S,x=new c("No Intersection");a=e.multiply(-1),f=t.multiply(3),l=n.multiply(-3),h=a.add(f.add(l.add(r))),p=new v(h.x,h.y),a=e.multiply(3),f=t.multiply(-6),l=n.multiply(3),h=a.add(f.add(l)),m=new v(h.x,h.y),a=e.multiply(-3),f=t.multiply(3),l=a.add(f),g=new v(l.x,l.y),y=new v(e.x,e.y),a=i.multiply(-1),f=s.multiply(3),l=o.multiply(-3),h=a.add(f.add(l.add(u))),b=new v(h.x,h.y),a=i.multiply(3),f=s.multiply(-6),l=o.multiply(3),h=a.add(f.add(l)),w=new v(h.x,h.y),a=i.multiply(-3),f=s.multiply(3),l=a.add(f),E=new v(l.x,l.y),S=new v(i.x,i.y);var T=y.x*y.x,N=y.x*y.x*y.x,C=y.y*y.y,k=y.y*y.y*y.y,L=g.x*g.x,A=g.x*g.x*g.x,O=g.y*g.y,M=g.y*g.y*g.y,_=m.x*m.x,D=m.x*m.x*m.x,P=m.y*m.y,H=m.y*m.y*m.y,B=p.x*p.x,j=p.x*p.x*p.x,F=p.y*p.y,I=p.y*p.y*p.y,q=S.x*S.x,R=S.x*S.x*S.x,U=S.y*S.y,z=S.y*S.y*S.y,W=E.x*E.x,X=E.x*E.x*E.x,V=E.y*E.y,$=w.x*w.x,J=w.x*w.x*w.x,K=w.y*w.y,Q=b.x*b.x,G=b.x*b.x*b.x,Y=b.y*b.y,Z=b.y*b.y*b.y,et=new d(-j*Z+I*G-3*p.x*F*Q*b.y+3*B*p.y*b.x*Y,-6*p.x*w.x*F*b.x*b.y+6*B*p.y*w.y*b.x*b.y+3*w.x*I*Q-3*j*w.y*Y-3*p.x*F*w.y*Q+3*B*w.x*p.y*Y,-6*E.x*p.x*F*b.x*b.y-6*p.x*w.x*F*w.y*b.x+6*B*w.x*p.y*w.y*b.y+3*E.x*I*Q+3*$*I*b.x+3*E.x*B*p.y*Y-3*p.x*E.y*F*Q-3*p.x*$*F*b.y+B*p.y*b.x*(6*E.y*b.y+3*K)+j*(-E.y*Y-2*K*b.y-b.y*(2*E.y*b.y+K)),g.x*m.y*p.x*p.y*b.x*b.y-g.y*m.x*p.x*p.y*b.x*b.y+6*E.x*w.x*I*b.x+3*g.x*m.x*p.x*p.y*Y+6*y.x*p.x*F*b.x*b.y-3*g.x*m.x*F*b.x*b.y-3*g.y*m.y*p.x*p.y*Q-6*y.y*B*p.y*b.x*b.y-6*S.x*p.x*F*b.x*b.y+3*g.y*m.y*B*b.x*b.y-2*m.x*P*p.x*b.x*b.y-6*E.x*p.x*w.x*F*b.y-6*E.x*p.x*F*w.y*b.x-6*p.x*E.y*w.x*F*b.x+6*E.x*B*p.y*w.y*b.y+2*_*m.y*p.y*b.x*b.y+J*I-3*y.x*I*Q+3*y.y*j*Y+3*S.x*I*Q+H*p.x*Q-D*p.y*Y-3*y.x*B*p.y*Y+3*y.y*p.x*F*Q-2*g.x*m.y*B*Y+g.x*m.y*F*Q-g.y*m.x*B*Y+2*g.y*m.x*F*Q+3*S.x*B*p.y*Y-m.x*P*p.y*Q-3*S.y*p.x*F*Q+_*m.y*p.x*Y-3*p.x*$*F*w.y+B*p.y*b.x*(6*S.y*b.y+6*E.y*w.y)+B*w.x*p.y*(6*E.y*b.y+3*K)+j*(-2*E.y*w.y*b.y-S.y*Y-w.y*(2*E.y*b.y+K)-b.y*(2*S.y*b.y+2*E.y*w.y)),6*g.x*m.x*p.x*p.y*w.y*b.y+g.x*m.y*p.x*w.x*p.y*b.y+g.x*m.y*p.x*p.y*w.y*b.x-g.y*m.x*p.x*w.x*p.y*b.y-g.y*m.x*p.x*p.y*w.y*b.x-6*g.y*m.y*p.x*w.x*p.y*b.x-6*y.x*w.x*I*b.x+6*S.x*w.x*I*b.x+6*y.y*j*w.y*b.y+2*H*p.x*w.x*b.x-2*D*p.y*w.y*b.y+6*y.x*p.x*w.x*F*b.y+6*y.x*p.x*F*w.y*b.x+6*y.y*p.x*w.x*F*b.x-3*g.x*m.x*w.x*F*b.y-3*g.x*m.x*F*w.y*b.x+2*g.x*m.y*w.x*F*b.x+4*g.y*m.x*w.x*F*b.x-6*y.x*B*p.y*w.y*b.y-6*y.y*B*w.x*p.y*b.y-6*y.y*B*p.y*w.y*b.x-4*g.x*m.y*B*w.y*b.y-6*S.x*p.x*w.x*F*b.y-6*S.x*p.x*F*w.y*b.x-2*g.y*m.x*B*w.y*b.y+3*g.y*m.y*B*w.x*b.y+3*g.y*m.y*B*w.y*b.x-2*m.x*P*p.x*w.x*b.y-2*m.x*P*p.x*w.y*b.x-2*m.x*P*w.x*p.y*b.x-6*S.y*p.x*w.x*F*b.x-6*E.x*p.x*E.y*F*b.x-6*E.x*p.x*w.x*F*w.y+6*S.x*B*p.y*w.y*b.y+2*_*m.y*p.x*w.y*b.y+2*_*m.y*w.x*p.y*b.y+2*_*m.y*p.y*w.y*b.x+3*E.x*$*I+3*W*I*b.x-3*p.x*E.y*$*F-3*W*p.x*F*b.y+B*w.x*p.y*(6*S.y*b.y+6*E.y*w.y)+B*p.y*b.x*(6*S.y*w.y+3*V)+E.x*B*p.y*(6*E.y*b.y+3*K)+j*(-2*S.y*w.y*b.y-b.y*(2*S.y*w.y+V)-E.y*(2*E.y*b.y+K)-w.y*(2*S.y*b.y+2*E.y*w.y)),g.x*E.x*m.y*p.x*p.y*b.y+g.x*m.y*p.x*E.y*p.y*b.x+g.x*m.y*p.x*w.x*p.y*w.y-g.y*m.x*E.x*p.x*p.y*b.y-g.y*m.x*p.x*E.y*p.y*b.x-g.y*m.x*p.x*w.x*p.y*w.y-6*g.y*E.x*m.y*p.x*p.y*b.x-6*y.x*E.x*I*b.x+6*S.x*E.x*I*b.x+2*E.x*H*p.x*b.x+6*y.x*E.x*p.x*F*b.y+6*y.x*p.x*E.y*F*b.x+6*y.x*p.x*w.x*F*w.y+6*y.y*E.x*p.x*F*b.x-3*g.x*m.x*E.x*F*b.y-3*g.x*m.x*E.y*F*b.x-3*g.x*m.x*w.x*F*w.y+2*g.x*E.x*m.y*F*b.x+4*g.y*m.x*E.x*F*b.x-6*y.y*E.x*B*p.y*b.y-6*y.y*B*E.y*p.y*b.x-6*y.y*B*w.x*p.y*w.y-6*S.x*E.x*p.x*F*b.y-6*S.x*p.x*E.y*F*b.x-6*S.x*p.x*w.x*F*w.y+3*g.y*E.x*m.y*B*b.y-3*g.y*m.y*p.x*$*p.y+3*g.y*m.y*B*E.y*b.x+3*g.y*m.y*B*w.x*w.y-2*m.x*E.x*P*p.x*b.y-2*m.x*E.x*P*p.y*b.x-2*m.x*P*p.x*E.y*b.x-2*m.x*P*p.x*w.x*w.y-6*S.y*E.x*p.x*F*b.x-6*E.x*p.x*E.y*w.x*F+6*S.y*B*E.y*p.y*b.x+2*_*E.x*m.y*p.y*b.y+2*_*m.y*E.y*p.y*b.x+2*_*m.y*w.x*p.y*w.y-3*y.x*$*I+3*S.x*$*I+3*W*w.x*I+H*p.x*$+3*y.y*p.x*$*F+g.x*m.y*$*F+2*g.y*m.x*$*F-m.x*P*$*p.y-3*S.y*p.x*$*F-3*W*p.x*F*w.y+_*m.y*p.x*(2*E.y*b.y+K)+g.x*m.x*p.x*p.y*(6*E.y*b.y+3*K)+E.x*B*p.y*(6*S.y*b.y+6*E.y*w.y)+D*p.y*(-2*E.y*b.y-K)+y.y*j*(6*E.y*b.y+3*K)+g.y*m.x*B*(-2*E.y*b.y-K)+g.x*m.y*B*(-4*E.y*b.y-2*K)+y.x*B*p.y*(-6*E.y*b.y-3*K)+B*w.x*p.y*(6*S.y*w.y+3*V)+S.x*B*p.y*(6*E.y*b.y+3*K)+j*(-2*S.y*E.y*b.y-w.y*(2*S.y*w.y+V)-S.y*(2*E.y*b.y+K)-E.y*(2*S.y*b.y+2*E.y*w.y)),-y.x*g.x*m.y*p.x*p.y*b.y+y.x*g.y*m.x*p.x*p.y*b.y+6*y.x*g.y*m.y*p.x*p.y*b.x-6*y.y*g.x*m.x*p.x*p.y*b.y-y.y*g.x*m.y*p.x*p.y*b.x+y.y*g.y*m.x*p.x*p.y*b.x+g.x*g.y*m.x*m.y*p.x*b.y-g.x*g.y*m.x*m.y*p.y*b.x+g.x*S.x*m.y*p.x*p.y*b.y+g.x*S.y*m.y*p.x*p.y*b.x+g.x*E.x*m.y*p.x*p.y*w.y+g.x*m.y*p.x*E.y*w.x*p.y-S.x*g.y*m.x*p.x*p.y*b.y-6*S.x*g.y*m.y*p.x*p.y*b.x-g.y*m.x*S.y*p.x*p.y*b.x-g.y*m.x*E.x*p.x*p.y*w.y-g.y*m.x*p.x*E.y*w.x*p.y-6*g.y*E.x*m.y*p.x*w.x*p.y-6*y.x*S.x*I*b.x-6*y.x*E.x*w.x*I-2*y.x*H*p.x*b.x+6*S.x*E.x*w.x*I+2*S.x*H*p.x*b.x+2*E.x*H*p.x*w.x+2*y.y*D*p.y*b.y-6*y.x*y.y*p.x*F*b.x+3*y.x*g.x*m.x*F*b.y-2*y.x*g.x*m.y*F*b.x-4*y.x*g.y*m.x*F*b.x+3*y.y*g.x*m.x*F*b.x+6*y.x*y.y*B*p.y*b.y+6*y.x*S.x*p.x*F*b.y-3*y.x*g.y*m.y*B*b.y+2*y.x*m.x*P*p.x*b.y+2*y.x*m.x*P*p.y*b.x+6*y.x*S.y*p.x*F*b.x+6*y.x*E.x*p.x*F*w.y+6*y.x*p.x*E.y*w.x*F+4*y.y*g.x*m.y*B*b.y+6*y.y*S.x*p.x*F*b.x+2*y.y*g.y*m.x*B*b.y-3*y.y*g.y*m.y*B*b.x+2*y.y*m.x*P*p.x*b.x+6*y.y*E.x*p.x*w.x*F-3*g.x*S.x*m.x*F*b.y+2*g.x*S.x*m.y*F*b.x+g.x*g.y*P*p.x*b.x-3*g.x*m.x*S.y*F*b.x-3*g.x*m.x*E.x*F*w.y-3*g.x*m.x*E.y*w.x*F+2*g.x*E.x*m.y*w.x*F+4*S.x*g.y*m.x*F*b.x+4*g.y*m.x*E.x*w.x*F-2*y.x*_*m.y*p.y*b.y-6*y.y*S.x*B*p.y*b.y-6*y.y*S.y*B*p.y*b.x-6*y.y*E.x*B*p.y*w.y-2*y.y*_*m.y*p.x*b.y-2*y.y*_*m.y*p.y*b.x-6*y.y*B*E.y*w.x*p.y-g.x*g.y*_*p.y*b.y-2*g.x*O*p.x*p.y*b.x+3*S.x*g.y*m.y*B*b.y-2*S.x*m.x*P*p.x*b.y-2*S.x*m.x*P*p.y*b.x-6*S.x*S.y*p.x*F*b.x-6*S.x*E.x*p.x*F*w.y-6*S.x*p.x*E.y*w.x*F+3*g.y*S.y*m.y*B*b.x+3*g.y*E.x*m.y*B*w.y+3*g.y*m.y*B*E.y*w.x-2*m.x*S.y*P*p.x*b.x-2*m.x*E.x*P*p.x*w.y-2*m.x*E.x*P*w.x*p.y-2*m.x*P*p.x*E.y*w.x-6*S.y*E.x*p.x*w.x*F-O*m.x*m.y*p.x*b.x+2*S.x*_*m.y*p.y*b.y+6*S.y*B*E.y*w.x*p.y+2*L*g.y*p.x*p.y*b.y+L*m.x*m.y*p.y*b.y+2*_*S.y*m.y*p.y*b.x+2*_*E.x*m.y*p.y*w.y+2*_*m.y*E.y*w.x*p.y+X*I+3*T*I*b.x-3*C*j*b.y+3*q*I*b.x+M*B*b.x-A*F*b.y-g.x*O*B*b.y+L*g.y*F*b.x-3*T*p.x*F*b.y+3*C*B*p.y*b.x-L*P*p.x*b.y+O*_*p.y*b.x-3*W*p.x*E.y*F-3*q*p.x*F*b.y+3*U*B*p.y*b.x+g.x*m.x*p.x*p.y*(6*S.y*b.y+6*E.y*w.y)+D*p.y*(-2*S.y*b.y-2*E.y*w.y)+y.y*j*(6*S.y*b.y+6*E.y*w.y)+g.y*m.x*B*(-2*S.y*b.y-2*E.y*w.y)+_*m.y*p.x*(2*S.y*b.y+2*E.y*w.y)+g.x*m.y*B*(-4*S.y*b.y-4*E.y*w.y)+y.x*B*p.y*(-6*S.y*b.y-6*E.y*w.y)+S.x*B*p.y*(6*S.y*b.y+6*E.y*w.y)+E.x*B*p.y*(6*S.y*w.y+3*V)+j*(-2*S.y*E.y*w.y-U*b.y-E.y*(2*S.y*w.y+V)-S.y*(2*S.y*b.y+2*E.y*w.y)),-y.x*g.x*m.y*p.x*p.y*w.y+y.x*g.y*m.x*p.x*p.y*w.y+6*y.x*g.y*m.y*p.x*w.x*p.y-6*y.y*g.x*m.x*p.x*p.y*w.y-y.y*g.x*m.y*p.x*w.x*p.y+y.y*g.y*m.x*p.x*w.x*p.y+g.x*g.y*m.x*m.y*p.x*w.y-g.x*g.y*m.x*m.y*w.x*p.y+g.x*S.x*m.y*p.x*p.y*w.y+g.x*S.y*m.y*p.x*w.x*p.y+g.x*E.x*m.y*p.x*E.y*p.y-S.x*g.y*m.x*p.x*p.y*w.y-6*S.x*g.y*m.y*p.x*w.x*p.y-g.y*m.x*S.y*p.x*w.x*p.y-g.y*m.x*E.x*p.x*E.y*p.y-6*y.x*S.x*w.x*I-2*y.x*H*p.x*w.x+2*S.x*H*p.x*w.x+2*y.y*D*p.y*w.y-6*y.x*y.y*p.x*w.x*F+3*y.x*g.x*m.x*F*w.y-2*y.x*g.x*m.y*w.x*F-4*y.x*g.y*m.x*w.x*F+3*y.y*g.x*m.x*w.x*F+6*y.x*y.y*B*p.y*w.y+6*y.x*S.x*p.x*F*w.y-3*y.x*g.y*m.y*B*w.y+2*y.x*m.x*P*p.x*w.y+2*y.x*m.x*P*w.x*p.y+6*y.x*S.y*p.x*w.x*F+6*y.x*E.x*p.x*E.y*F+4*y.y*g.x*m.y*B*w.y+6*y.y*S.x*p.x*w.x*F+2*y.y*g.y*m.x*B*w.y-3*y.y*g.y*m.y*B*w.x+2*y.y*m.x*P*p.x*w.x-3*g.x*S.x*m.x*F*w.y+2*g.x*S.x*m.y*w.x*F+g.x*g.y*P*p.x*w.x-3*g.x*m.x*S.y*w.x*F-3*g.x*m.x*E.x*E.y*F+4*S.x*g.y*m.x*w.x*F-2*y.x*_*m.y*p.y*w.y-6*y.y*S.x*B*p.y*w.y-6*y.y*S.y*B*w.x*p.y-6*y.y*E.x*B*E.y*p.y-2*y.y*_*m.y*p.x*w.y-2*y.y*_*m.y*w.x*p.y-g.x*g.y*_*p.y*w.y-2*g.x*O*p.x*w.x*p.y+3*S.x*g.y*m.y*B*w.y-2*S.x*m.x*P*p.x*w.y-2*S.x*m.x*P*w.x*p.y-6*S.x*S.y*p.x*w.x*F-6*S.x*E.x*p.x*E.y*F+3*g.y*S.y*m.y*B*w.x+3*g.y*E.x*m.y*B*E.y-2*m.x*S.y*P*p.x*w.x-2*m.x*E.x*P*p.x*E.y-O*m.x*m.y*p.x*w.x+2*S.x*_*m.y*p.y*w.y-3*g.y*W*m.y*p.x*p.y+6*S.y*E.x*B*E.y*p.y+2*L*g.y*p.x*p.y*w.y+L*m.x*m.y*p.y*w.y+2*_*S.y*m.y*w.x*p.y+2*_*E.x*m.y*E.y*p.y-3*y.x*W*I+3*S.x*W*I+3*T*w.x*I-3*C*j*w.y+3*q*w.x*I+W*H*p.x+M*B*w.x-A*F*w.y+3*y.y*W*p.x*F-g.x*O*B*w.y+g.x*W*m.y*F+2*g.y*m.x*W*F+L*g.y*w.x*F-m.x*W*P*p.y-3*S.y*W*p.x*F-3*T*p.x*F*w.y+3*C*B*w.x*p.y-L*P*p.x*w.y+O*_*w.x*p.y-3*q*p.x*F*w.y+3*U*B*w.x*p.y+_*m.y*p.x*(2*S.y*w.y+V)+g.x*m.x*p.x*p.y*(6*S.y*w.y+3*V)+D*p.y*(-2*S.y*w.y-V)+y.y*j*(6*S.y*w.y+3*V)+g.y*m.x*B*(-2*S.y*w.y-V)+g.x*m.y*B*(-4*S.y*w.y-2*V)+y.x*B*p.y*(-6*S.y*w.y-3*V)+S.x*B*p.y*(6*S.y*w.y+3*V)+j*(-2*S.y*V-U*w.y-S.y*(2*S.y*w.y+V)),-y.x*g.x*m.y*p.x*E.y*p.y+y.x*g.y*m.x*p.x*E.y*p.y+6*y.x*g.y*E.x*m.y*p.x*p.y-6*y.y*g.x*m.x*p.x*E.y*p.y-y.y*g.x*E.x*m.y*p.x*p.y+y.y*g.y*m.x*E.x*p.x*p.y-g.x*g.y*m.x*E.x*m.y*p.y+g.x*g.y*m.x*m.y*p.x*E.y+g.x*S.x*m.y*p.x*E.y*p.y+6*g.x*m.x*S.y*p.x*E.y*p.y+g.x*S.y*E.x*m.y*p.x*p.y-S.x*g.y*m.x*p.x*E.y*p.y-6*S.x*g.y*E.x*m.y*p.x*p.y-g.y*m.x*S.y*E.x*p.x*p.y-6*y.x*S.x*E.x*I-2*y.x*E.x*H*p.x+6*y.y*S.y*j*E.y+2*S.x*E.x*H*p.x+2*y.y*D*E.y*p.y-2*D*S.y*E.y*p.y-6*y.x*y.y*E.x*p.x*F+3*y.x*g.x*m.x*E.y*F-2*y.x*g.x*E.x*m.y*F-4*y.x*g.y*m.x*E.x*F+3*y.y*g.x*m.x*E.x*F+6*y.x*y.y*B*E.y*p.y+6*y.x*S.x*p.x*E.y*F-3*y.x*g.y*m.y*B*E.y+2*y.x*m.x*E.x*P*p.y+2*y.x*m.x*P*p.x*E.y+6*y.x*S.y*E.x*p.x*F+4*y.y*g.x*m.y*B*E.y+6*y.y*S.x*E.x*p.x*F+2*y.y*g.y*m.x*B*E.y-3*y.y*g.y*E.x*m.y*B+2*y.y*m.x*E.x*P*p.x-3*g.x*S.x*m.x*E.y*F+2*g.x*S.x*E.x*m.y*F+g.x*g.y*E.x*P*p.x-3*g.x*m.x*S.y*E.x*F+4*S.x*g.y*m.x*E.x*F-6*y.x*S.y*B*E.y*p.y-2*y.x*_*m.y*E.y*p.y-6*y.y*S.x*B*E.y*p.y-6*y.y*S.y*E.x*B*p.y-2*y.y*_*E.x*m.y*p.y-2*y.y*_*m.y*p.x*E.y-g.x*g.y*_*E.y*p.y-4*g.x*S.y*m.y*B*E.y-2*g.x*O*E.x*p.x*p.y+3*S.x*g.y*m.y*B*E.y-2*S.x*m.x*E.x*P*p.y-2*S.x*m.x*P*p.x*E.y-6*S.x*S.y*E.x*p.x*F-2*g.y*m.x*S.y*B*E.y+3*g.y*S.y*E.x*m.y*B-2*m.x*S.y*E.x*P*p.x-O*m.x*E.x*m.y*p.x+6*S.x*S.y*B*E.y*p.y+2*S.x*_*m.y*E.y*p.y+2*L*g.y*p.x*E.y*p.y+L*m.x*m.y*E.y*p.y+2*_*S.y*E.x*m.y*p.y+2*_*S.y*m.y*p.x*E.y+3*T*E.x*I-3*C*j*E.y+3*q*E.x*I+M*E.x*B-A*E.y*F-3*U*j*E.y-g.x*O*B*E.y+L*g.y*E.x*F-3*T*p.x*E.y*F+3*C*E.x*B*p.y-L*P*p.x*E.y+O*_*E.x*p.y-3*q*p.x*E.y*F+3*U*E.x*B*p.y,y.x*y.y*g.x*m.y*p.x*p.y-y.x*y.y*g.y*m.x*p.x*p.y+y.x*g.x*g.y*m.x*m.y*p.y-y.y*g.x*g.y*m.x*m.y*p.x-y.x*g.x*S.y*m.y*p.x*p.y+6*y.x*S.x*g.y*m.y*p.x*p.y+y.x*g.y*m.x*S.y*p.x*p.y-y.y*g.x*S.x*m.y*p.x*p.y-6*y.y*g.x*m.x*S.y*p.x*p.y+y.y*S.x*g.y*m.x*p.x*p.y-g.x*S.x*g.y*m.x*m.y*p.y+g.x*g.y*m.x*S.y*m.y*p.x+g.x*S.x*S.y*m.y*p.x*p.y-S.x*g.y*m.x*S.y*p.x*p.y-2*y.x*S.x*H*p.x+2*y.y*D*S.y*p.y-3*y.x*y.y*g.x*m.x*F-6*y.x*y.y*S.x*p.x*F+3*y.x*y.y*g.y*m.y*B-2*y.x*y.y*m.x*P*p.x-2*y.x*g.x*S.x*m.y*F-y.x*g.x*g.y*P*p.x+3*y.x*g.x*m.x*S.y*F-4*y.x*S.x*g.y*m.x*F+3*y.y*g.x*S.x*m.x*F+6*y.x*y.y*S.y*B*p.y+2*y.x*y.y*_*m.y*p.y+2*y.x*g.x*O*p.x*p.y+2*y.x*S.x*m.x*P*p.y+6*y.x*S.x*S.y*p.x*F-3*y.x*g.y*S.y*m.y*B+2*y.x*m.x*S.y*P*p.x+y.x*O*m.x*m.y*p.x+y.y*g.x*g.y*_*p.y+4*y.y*g.x*S.y*m.y*B-3*y.y*S.x*g.y*m.y*B+2*y.y*S.x*m.x*P*p.x+2*y.y*g.y*m.x*S.y*B+g.x*S.x*g.y*P*p.x-3*g.x*S.x*m.x*S.y*F-2*y.x*_*S.y*m.y*p.y-6*y.y*S.x*S.y*B*p.y-2*y.y*S.x*_*m.y*p.y-2*y.y*L*g.y*p.x*p.y-y.y*L*m.x*m.y*p.y-2*y.y*_*S.y*m.y*p.x-2*g.x*S.x*O*p.x*p.y-g.x*g.y*_*S.y*p.y+3*S.x*g.y*S.y*m.y*B-2*S.x*m.x*S.y*P*p.x-S.x*O*m.x*m.y*p.x+3*C*g.x*m.x*p.x*p.y+3*g.x*m.x*U*p.x*p.y+2*S.x*_*S.y*m.y*p.y-3*T*g.y*m.y*p.x*p.y+2*L*g.y*S.y*p.x*p.y+L*m.x*S.y*m.y*p.y-3*q*g.y*m.y*p.x*p.y-N*I+k*j+R*I-z*j-3*y.x*q*I-y.x*M*B+3*T*S.x*I+y.y*A*F+3*y.y*U*j+S.x*M*B+T*H*p.x-3*C*S.y*j-C*D*p.y+q*H*p.x-A*S.y*F-D*U*p.y-y.x*L*g.y*F+y.y*g.x*O*B-3*y.x*C*B*p.y-y.x*O*_*p.y+y.y*L*P*p.x-g.x*O*S.y*B+3*T*y.y*p.x*F+T*g.x*m.y*F+2*T*g.y*m.x*F-2*C*g.x*m.y*B-C*g.y*m.x*B+L*S.x*g.y*F-3*y.x*U*B*p.y+3*y.y*q*p.x*F+g.x*q*m.y*F-2*g.x*U*m.y*B+S.x*O*_*p.y-g.y*m.x*U*B-T*m.x*P*p.y-3*T*S.y*p.x*F+3*C*S.x*B*p.y+C*_*m.y*p.x-L*S.y*P*p.x+2*q*g.y*m.x*F+3*S.x*U*B*p.y-q*m.x*P*p.y-3*q*S.y*p.x*F+_*U*m.y*p.x),tt=et.getRootsInInterval(0,1);for(var nt=0;nt<tt.length;nt++){var rt=tt[nt],it=(new d(p.x,m.x,g.x,y.x-S.x-rt*E.x-rt*rt*w.x-rt*rt*rt*b.x)).getRoots(),st=(new d(p.y,m.y,g.y,y.y-S.y-rt*E.y-rt*rt*w.y-rt*rt*rt*b.y)).getRoots();if(it.length>0&&st.length>0){var ot=1e-4;e:for(var ut=0;ut<it.length;ut++){var at=it[ut];if(0<=at&&at<=1)for(var ft=0;ft<st.length;ft++)if(Math.abs(at-st[ft])<ot){x.points.push(b.multiply(rt*rt*rt).add(w.multiply(rt*rt).add(E.multiply(rt).add(S))));break e}}}}return x.points.length>0&&(x.status="Intersection"),x},c.intersectBezier3Circle=function(e,t,n,r,i,s){return c.intersectBezier3Ellipse(e,t,n,r,i,s,s)},c.intersectBezier3Ellipse=function(e,t,n,r,i,s,o){var u,a,f,l,h,p,m,g,y=new c("No Intersection");u=e.multiply(-1),a=t.multiply(3),f=n.multiply(-3),l=u.add(a.add(f.add(r))),h=new v(l.x,l.y),u=e.multiply(3),a=t.multiply(-6),f=n.multiply(3),l=u.add(a.add(f)),p=new v(l.x,l.y),u=e.multiply(-3),a=t.multiply(3),f=u.add(a),m=new v(f.x,f.y),g=new v(e.x,e.y);var b=s*s,w=o*o,E=new d(h.x*h.x*w+h.y*h.y*b,2*(h.x*p.x*w+h.y*p.y*b),2*(h.x*m.x*w+h.y*m.y*b)+p.x*p.x*w+p.y*p.y*b,2*h.x*w*(g.x-i.x)+2*h.y*b*(g.y-i.y)+2*(p.x*m.x*w+p.y*m.y*b),2*p.x*w*(g.x-i.x)+2*p.y*b*(g.y-i.y)+m.x*m.x*w+m.y*m.y*b,2*m.x*w*(g.x-i.x)+2*m.y*b*(g.y-i.y),g.x*g.x*w-2*g.y*i.y*b-2*g.x*i.x*w+g.y*g.y*b+i.x*i.x*w+i.y*i.y*b-b*w),S=E.getRootsInInterval(0,1);for(var x=0;x<S.length;x++){var T=S[x];y.points.push(h.multiply(T*T*T).add(p.multiply(T*T).add(m.multiply(T).add(g))))}return y.points.length>0&&(y.status="Intersection"),y},c.intersectBezier3Line=function(e,t,n,r,i,s){var o,u,a,f,l,h,p,m,g,y,b=i.min(s),w=i.max(s),E=new c("No Intersection");o=e.multiply(-1),u=t.multiply(3),a=n.multiply(-3),f=o.add(u.add(a.add(r))),l=new v(f.x,f.y),o=e.multiply(3),u=t.multiply(-6),a=n.multiply(3),f=o.add(u.add(a)),h=new v(f.x,f.y),o=e.multiply(-3),u=t.multiply(3),a=o.add(u),p=new v(a.x,a.y),m=new v(e.x,e.y),y=new v(i.y-s.y,s.x-i.x),g=i.x*s.y-s.x*i.y,roots=(new d(y.dot(l),y.dot(h),y.dot(p),y.dot(m)+g)).getRoots();for(var S=0;S<roots.length;S++){var x=roots[S];if(0<=x&&x<=1){var T=e.lerp(t,x),N=t.lerp(n,x),C=n.lerp(r,x),k=T.lerp(N,x),L=N.lerp(C,x),A=k.lerp(L,x);i.x==s.x?b.y<=A.y&&A.y<=w.y&&(E.status="Intersection",E.appendPoint(A)):i.y==s.y?b.x<=A.x&&A.x<=w.x&&(E.status="Intersection",E.appendPoint(A)):A.gte(b)&&A.lte(w)&&(E.status="Intersection",E.appendPoint(A))}}return E},c.intersectBezier3Polygon=function(e,t,n,r,i){var s=new c("No Intersection"),o=i.length;for(var u=0;u<o;u++){var a=i[u],f=i[(u+1)%o],l=c.intersectBezier3Line(e,t,n,r,a,f);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},c.intersectBezier3Rectangle=function(e,t,n,r,i,s){var o=i.min(s),u=i.max(s),a=new p(u.x,o.y),f=new p(o.x,u.y),l=c.intersectBezier3Line(e,t,n,r,o,a),h=c.intersectBezier3Line(e,t,n,r,a,u),d=c.intersectBezier3Line(e,t,n,r,u,f),v=c.intersectBezier3Line(e,t,n,r,f,o),m=new c("No Intersection");return m.appendPoints(l.points),m.appendPoints(h.points),m.appendPoints(d.points),m.appendPoints(v.points),m.points.length>0&&(m.status="Intersection"),m},c.intersectCircleCircle=function(e,t,n,r){var i,s=t+r,o=Math.abs(t-r),u=e.distanceFrom(n);if(u>s)i=new c("Outside");else if(u<o)i=new c("Inside");else{i=new c("Intersection");var a=(t*t-r*r+u*u)/(2*u),f=Math.sqrt(t*t-a*a),l=e.lerp(n,a/u),h=f/u;i.points.push(new p(l.x-h*(n.y-e.y),l.y+h*(n.x-e.x))),i.points.push(new p(l.x+h*(n.y-e.y),l.y-h*(n.x-e.x)))}return i},c.intersectCircleEllipse=function(e,t,n,r,i){return c.intersectEllipseEllipse(e,t,t,n,r,i)},c.intersectCircleLine=function(e,t,n,r){var i,s=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),o=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),u=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t,a=o*o-4*s*u;if(a<0)i=new c("Outside");else if(a==0)i=new c("Tangent");else{var f=Math.sqrt(a),l=(-o+f)/(2*s),h=(-o-f)/(2*s);(l<0||l>1)&&(h<0||h>1)?l<0&&h<0||l>1&&h>1?i=new c("Outside"):i=new c("Inside"):(i=new c("Intersection"),0<=l&&l<=1&&i.points.push(n.lerp(r,l)),0<=h&&h<=1&&i.points.push(n.lerp(r,h)))}return i},c.intersectCirclePolygon=function(e,t,n){var r=new c("No Intersection"),i=n.length,s;for(var o=0;o<i;o++){var u=n[o],a=n[(o+1)%i];s=c.intersectCircleLine(e,t,u,a),r.appendPoints(s.points)}return r.points.length>0?r.status="Intersection":r.status=s.status,r},c.intersectCircleRectangle=function(e,t,n,r){var i=n.min(r),s=n.max(r),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectCircleLine(e,t,i,o),f=c.intersectCircleLine(e,t,o,s),l=c.intersectCircleLine(e,t,s,u),h=c.intersectCircleLine(e,t,u,i),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0?d.status="Intersection":d.status=a.status,d},c.intersectEllipseEllipse=function(e,t,n,r,i,s){var o=[n*n,0,t*t,-2*n*n*e.x,-2*t*t*e.y,n*n*e.x*e.x+t*t*e.y*e.y-t*t*n*n],u=[s*s,0,i*i,-2*s*s*r.x,-2*i*i*r.y,s*s*r.x*r.x+i*i*r.y*r.y-i*i*s*s],a=c.bezout(o,u),f=a.getRoots(),l=.001,h=(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2])*l,v=(u[0]*u[0]+2*u[1]*u[1]+u[2]*u[2])*l,m=new c("No Intersection");for(var g=0;g<f.length;g++){var y=new d(o[0],o[3]+f[g]*o[1],o[5]+f[g]*(o[4]+f[g]*o[2])),b=y.getRoots();for(var w=0;w<b.length;w++){var E=(o[0]*b[w]+o[1]*f[g]+o[3])*b[w]+(o[2]*f[g]+o[4])*f[g]+o[5];Math.abs(E)<h&&(E=(u[0]*b[w]+u[1]*f[g]+u[3])*b[w]+(u[2]*f[g]+u[4])*f[g]+u[5],Math.abs(E)<v&&m.appendPoint(new p(b[w],f[g])))}}return m.points.length>0&&(m.status="Intersection"),m},c.intersectEllipseLine=function(e,t,n,r,i){var s,o=new v(r.x,r.y),u=v.fromPoints(r,i),a=new v(e.x,e.y),f=o.subtract(a),l=new v(u.x/(t*t),u.y/(n*n)),h=new v(f.x/(t*t),f.y/(n*n)),p=u.dot(l),d=u.dot(h),e=f.dot(h)-1,m=d*d-p*e;if(m<0)s=new c("Outside");else if(m>0){var g=Math.sqrt(m),y=(-d-g)/p,b=(-d+g)/p;(y<0||1<y)&&(b<0||1<b)?y<0&&b<0||y>1&&b>1?s=new c("Outside"):s=new c("Inside"):(s=new c("Intersection"),0<=y&&y<=1&&s.appendPoint(r.lerp(i,y)),0<=b&&b<=1&&s.appendPoint(r.lerp(i,b)))}else{var w=-d/p;0<=w&&w<=1?(s=new c("Intersection"),s.appendPoint(r.lerp(i,w))):s=new c("Outside")}return s},c.intersectEllipsePolygon=function(e,t,n,r){var i=new c("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=c.intersectEllipseLine(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},c.intersectEllipseRectangle=function(e,t,n,r,i){var s=r.min(i),o=r.max(i),u=new p(o.x,s.y),a=new p(s.x,o.y),f=c.intersectEllipseLine(e,t,n,s,u),l=c.intersectEllipseLine(e,t,n,u,o),h=c.intersectEllipseLine(e,t,n,o,a),d=c.intersectEllipseLine(e,t,n,a,s),v=new c("No Intersection");return v.appendPoints(f.points),v.appendPoints(l.points),v.appendPoints(h.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v},c.intersectLineLine=function(e,t,n,r){var i,s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!=0){var a=s/u,f=o/u;0<=a&&a<=1&&0<=f&&f<=1?(i=new c("Intersection"),i.points.push(new p(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)))):i=new c("No Intersection")}else s==0||o==0?i=new c("Coincident"):i=new c("Parallel");return i},c.intersectLinePolygon=function(e,t,n){var r=new c("No Intersection"),i=n.length;for(var s=0;s<i;s++){var o=n[s],u=n[(s+1)%i],a=c.intersectLineLine(e,t,o,u);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},c.intersectLineRectangle=function(e,t,n,r){var i=n.min(r),s=n.max(r),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectLineLine(i,o,e,t),f=c.intersectLineLine(o,s,e,t),l=c.intersectLineLine(s,u,e,t),h=c.intersectLineLine(u,i,e,t),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},c.intersectPolygonPolygon=function(e,t){var n=new c("No Intersection"),r=e.length;for(var i=0;i<r;i++){var s=e[i],o=e[(i+1)%r],u=c.intersectLinePolygon(s,o,t);n.appendPoints(u.points)}return n.points.length>0&&(n.status="Intersection"),n},c.intersectPolygonRectangle=function(e,t,n){var r=t.min(n),i=t.max(n),s=new p(i.x,r.y),o=new p(r.x,i.y),u=c.intersectLinePolygon(r,s,e),a=c.intersectLinePolygon(s,i,e),f=c.intersectLinePolygon(i,o,e),l=c.intersectLinePolygon(o,r,e),h=new c("No Intersection");return h.appendPoints(u.points),h.appendPoints(a.points),h.appendPoints(f.points),h.appendPoints(l.points),h.points.length>0&&(h.status="Intersection"),h},c.intersectRayRay=function(e,t,n,r){var i,s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!=0){var a=s/u;i=new c("Intersection"),i.points.push(new p(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)))}else s==0||o==0?i=new c("Coincident"):i=new c("Parallel");return i},c.intersectRectangleRectangle=function(e,t,n,r){var i=e.min(t),s=e.max(t),o=new p(s.x,i.y),u=new p(i.x,s.y),a=c.intersectLineRectangle(i,o,n,r),f=c.intersectLineRectangle(o,s,n,r),l=c.intersectLineRectangle(s,u,n,r),h=c.intersectLineRectangle(u,i,n,r),d=new c("No Intersection");return d.appendPoints(a.points),d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d},c.bezout=function(e,t){var n=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],i=e[0]*t[3]-t[0]*e[3],s=e[0]*t[4]-t[0]*e[4],o=e[0]*t[5]-t[0]*e[5],u=e[1]*t[2]-t[1]*e[2],a=e[1]*t[4]-t[1]*e[4],f=e[1]*t[5]-t[1]*e[5],l=e[2]*t[3]-t[2]*e[3],c=e[3]*t[4]-t[3]*e[4],h=e[3]*t[5]-t[3]*e[5],p=f+c,v=a-l;return new d(n*u-r*r,n*v+i*u-2*r*s,n*p+i*v-s*s-2*r*o,n*h+i*p-2*s*o,i*h-o*o)},t("futuregrapher/../../vendor/intersect.js",function(){}),t("futuregrapher/svgrenderer",["require","futuregrapher/svgrendererdefaultoptions","../../vendor/intersect.js"],function(e){var t=e("futuregrapher/svgrendererdefaultoptions");e("../../vendor/intersect.js"),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var n=function(e,n){function u(e,t,n,r){var i=e.nodeCircles,s=[];_.each(i,function(e){var i=(e.radius||5)*r,o=e.x||0,u=e.y||0;s.push([t(o)-i,n(u)-i]),s.push([t(o)-i,n(u)+i]),s.push([t(o)+i,n(u)-i]),s.push([t(o)+i,n(u)+i])});var o=d3.svg.line().interpolate("cardinal-closed").tension(.85);return o(d3.geom.hull(s))}function a(e,t,n,r){var i=t(e.source.x),s=n(e.source.y),o=t(e.target.x),u=n(e.target.y),a=(e.source.radius+e.source.borderWidth)*r,f=(e.target.radius+e.target.borderWidth)*r,l=o-i,h=u-s,p=Math.sqrt(l*l+h*h)||.001,d=L?i+l*(a/p):i,v=L?s+h*(a/p):s,m=L?o-l*(f/p):o,g=L?u-h*(f/p):u;if(e.curvature===0){if(i===o&&s===u)return"M "+d+" "+v+" A 10 10 0 1 "+(m>d?"1":"0")+" "+(m+1)+" "+(g+1);var a=(e.source.radius+e.source.borderWidth)*r,f=(e.target.radius+e.target.borderWidth)*r,y=o-i,b=u-s,w=Math.sqrt(y*y+b*b),E=(o-i)/w,S=(u-s)/w,x=i+a*E,T=s+a*S,N=o-f*E,C=u-f*S,k="M "+x+" "+T+" L "+N+" "+C;return k}var L=!0;if(d==m&&v==g)return"M "+d+" "+v+" A 10 10 0 1 "+(m>d?"1":"0")+" "+(m+1)+" "+(g+1);var A=(i-o)/2,O=(s-u)/2,M=Math.sqrt((p*p*p*p-p*p*O*O-p*p*A*A)/(p*p*O*O+p*p*A*A));m<d&&(M*=-1);var _=M*O,D=M*-1*A,P=_+(i+o)/2,H=D+(s+u)/2,k=c.intersectCircleEllipse({x:o,y:u},f,{x:P,y:H},p,p);if(k.points.length){var B=1e6,j;$.each(k.points,function(e,t){var n=Math.sqrt(Math.pow(t.x-i,2)+Math.pow(t.y-s,2));n<B&&(B=n,j=t)}),j&&(m=j.x,g=j.y)}k=c.intersectCircleEllipse({x:i,y:s},a,{x:P,y:H},p,p);if(k.points.length){var B=1e6,j;$.each(k.points,function(e,t){var n=Math.sqrt(Math.pow(t.x-o,2)+Math.pow(t.y-u,2));n<B&&(B=n,j=t)}),j&&(i=j.x,s=j.y)}return isNaN(i)&&(i=0),isNaN(s)&&(s=0),isNaN(m)&&(m=0),isNaN(g)&&(g=0),"M "+i+" "+s+" A "+p+" "+p+" 0 0 "+(m>d?"1":"0")+" "+m+" "+g}function f(e,t,n,r,i,s){return function(i){if(!r||!i)return s;var o=a(r,e,t,n);if(!o)return"";var u=d3.interpolateString(s,o),f=u(i),l=f.split(" ");return l[3]=="A"&&(l[7]=Math.floor(parseFloat(l[7])),l[8]=Math.floor(parseFloat(l[8]))),l.join(" ")}}function l(e){var t={};return _.each(e,function(e){if(e.marker){var n=Math.max(1,e.width).toFixed(0),r=d3.rgb(e.color).toString(),i=e.opacity,s=n+"-"+r.substr(1)+Math.floor(i*255).toString(16);t[s]={id:s,size:n,color:r,opacity:i}}}),_.map(t,function(e,t){return e})}function h(e,t){return e.anchor==="auto"?e.x<t?"end":"start":e.anchor}function p(e,t){var n,r=_.uniq(_.flatten(_.map(_.pluck(t,"eventHandlers"),function(e){return _.keys(e)})));_.each(r,function(t){if(t==="click"||t==="dblclick")return;t==="dragstart"||t==="drag"||t==="dragend"?(n||(n=d3.behavior.drag().origin(function(){var e=d3.select(this);return{x:e.attr("x"),y:e.attr("y")}})),n.on(t,function(e,n){e.eventHandlers[t](e,n,d3.event)})):e.on(t,function(e,n){e.eventHandlers.hasOwnProperty(t)&&(e.eventHandlers[t](e,n,d3.event),d3.event.stopPropagation())})}),n&&e.call(n);var i=300,s,o;e.on("click",function(e,t){e.eventHandlers.hasOwnProperty("click")&&e.eventHandlers.hasOwnProperty("dblclick")?(s?(e.eventHandlers.dblclick(e,t,d3.event),clearTimeout(s),s=null):(o=d3.event,s=setTimeout(function(){e.eventHandlers.click(e,t,o),s=null},i)),d3.event.stopPropagation()):e.eventHandlers.hasOwnProperty("click")&&(e.eventHandlers.click(e,t,d3.event),d3.event.stopPropagation())}),e.on("dblclick",function(e,t){e.eventHandlers.hasOwnProperty("dblclick")&&!e.eventHandlers.hasOwnProperty("click")&&(e.eventHandlers.dblclick(e,t,d3.event),d3.event.stopPropagation())})}function d(){r=d3.select(e[0]).append("svg").attr("width",e.width()).attr("height",e.height()),i=r.append("svg:defs"),s={},_.each(n.layerIds,function(e){s[e]=r.append("svg:g").attr("id",e).attr("class","layer")})}function v(e,t,n){var r=t(e.x),i=n(e.y);return"translate("+[isNaN(r)?0:r,isNaN(i)?0:i]+")"}n=$.extend(!0,{},t,n);var r,i,s={},o;this.containerElement=function(){return e},this.width=function(){return e.width()},this.height=function(){return e.height()},this.getLayer=function(e){return s[e]},this.update=function(e,t,n,r,a,c,d,m){m=m===undefined?250:m;var g=d3.mean(n,function(e){return e.x});TypeChecker.enabled&&_.each(e,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var y=s.clusters.selectAll("path.cluster").data(e,function(e){return e.id}),b=y.enter().append("svg:path");b.attr("class","cluster").attr("data-id",function(e){return e.id}).style("fill",function(e){return e.color}).style("stroke",function(e){return e.borderColor}).style("opacity",1e-6).append("svg:title"),p(b,e),y.exit().transition().duration(m).style("opacity",1e-6).remove(),y.transition().duration(m).attr("d",function(e){return u(e,a,c,d)}).style("opacity",function(e){return e.opacity}).style("fill",function(e){return e.color}).style("stroke",function(e){return e.borderColor}),y.select("title").text(function(e){return e.hoverText});var w=l(t),E=i.selectAll("marker.generated").data(w,function(e){return e.id});E.enter().append("svg:marker").attr("id",function(e){return"marker-"+e.id}).attr("class","generated").attr("preserveAspectRatio","xMinYMin").attr("markerUnits","userSpaceOnUse").attr("orient","auto").append("svg:path"),E.attr("markerWidth",function(e){return 5*e.size*d}).attr("markerHeight",function(e){return 3*e.size*d}).attr("viewBox",function(e){return"0 0 "+10*e.size*d+" "+10*e.size*d}).attr("refX",function(e){return 10*e.size*d}).attr("refY",function(e){return 10*e.size*d}).attr("fill",function(e){return e.color}).attr("opacity",function(e){return e.opacity}).select("path").attr("d",function(e){return"M0,0L"+10*e.size*d+","+10*e.size*d+"L0,"+10*e.size*d+"z"}),E.exit().remove(),TypeChecker.enabled&&_.each(t,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var S=s.links.selectAll("path.link").data(t,function(e){return e.id}),x=S.enter().append("svg:path");x.attr("class","link").attr("data-id",function(e){return e.id}).style("stroke-opacity",1e-6).style("stroke-width",1e-6).style("fill","none").append("svg:title"),p(x,t),S.exit().transition().duration(m).style("stroke-opacity",1e-6).style("stroke-width",1e-6).remove(),S.attr("stroke-dasharray",function(e){return e.dashPattern}).attr("marker-end",function(e){if(!e.marker)return null;var t=+e.width.toFixed(0)+"-"+d3.rgb(e.color).toString().substr(1)+Math.floor(e.opacity*255).toString(16);return"url(#marker-"+t+")"}),S.transition().duration(m).attrTween("d",f.bind(null,a,c,d)).style("stroke-opacity",function(e){return e.opacity}).style("stroke-width",function(e){return e.width*d}).style("stroke",function(e){return e.color}),S.select("title").text(function(e){return e.hoverText}),TypeChecker.enabled&&_.each(n,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var T=s.nodes.selectAll("circle.node").data(n,function(e){return e.id}),N=T.enter().append("svg:circle");N.attr("class","node").attr("data-id",function(e){return e.id}).attr("cx",function(e){var t=a(e.x);return isNaN(t)?0:t}).attr("cy",function(e){var t=c(e.y);return isNaN(t)?0:t}).attr("r",1e-6).style("opacity",1e-6).append("svg:title"),p(N,n),T.exit().transition().duration(m).attr("r",1e-6).style("opacity",1e-6).remove(),T.transition().duration(m).attr("cx",function(e){var t=a(e.x);return isNaN(t)?0:t}).attr("cy",function(e){var t=c(e.y);return isNaN(t)?0:t}).attr("r",function(e){return(e.radius||1)*(d<100?d:100)}).style("stroke-width",function(e){return e.borderWidth*d}).style("opacity",function(e){return e.opacity}).style("fill",function(e){return e.color}).style("stroke",function(e){return e.borderColor}),T.select("title").text(function(e){return e.hoverText}),TypeChecker.enabled&&_.each(r,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var C=s.labels.selectAll("g.label").data(r,function(e){return e.id}),k=C.enter().append("svg:g");k.attr("class","label").attr("data-id",function(e){return e.id}).attr("transform",function(e){return v(e,a,c)}).style("opacity",1e-6).append("svg:text").attr("x",function(e){var t=e.offsetX*d;return isNaN(t)||t==Infinity?0:t}).attr("y",function(e){var t=e.offsetY*d;return isNaN(t)||t==Infinity?0:t}).style("font-size",function(e){return e.fontSize*d}),p(k,r),C.exit().transition().duration(m).style("opacity",1e-6).remove(),C.transition().duration(m).attr("transform",function(e){return v(e,a,c)}).style("opacity",function(e){return e.opacity}),C.select("text").text(function(e){return e.text}).transition().duration(m).attr("text-anchor",function(e){return h(e,g)}).attr("x",function(e){var t=(h(e,g)==="end"?-e.offsetX:e.offsetX)*d;return isNaN(t)||t==Infinity?0:t}).attr("y",function(e){var t=e.offsetY*d;return isNaN(t)||t==Infinity?0:t}).style("font-size",function(e){return e.fontSize*d}).style("fill",function(e){return e.color}),o=d},this.updatePositions=function(e,t,n,r,f,c,p){var d=d3.mean(n,function(e){return e.x}),m=s.clusters.selectAll("path.cluster").data(e,function(e){return e.id});m.attr("d",function(e){return u(e,f,c,p)});var g=l(t),y=i.selectAll("marker.generated").data(g,function(e){return e.id});y.enter().append("svg:marker").attr("id",function(e){return e.id}).attr("class","generated").attr("preserveAspectRatio","xMinYMin").attr("markerUnits","userSpaceOnUse").attr("orient","auto").append("svg:path"),y.attr("markerWidth",function(e){return 5*e.size*p}).attr("markerHeight",function(e){return 3*e.size*p}).attr("viewBox",function(e){return"0 0 "+10*e.size*p+" "+10*e.size*p}).attr("refX",function(e){return 10*e.size*p}).attr("refY",function(e){return 10*e.size*p}).attr("fill",function(e){return e.color}).select("path").attr("d",function(e){return"M0,0L"+10*e.size*p+","+10*e.size*p+"L0,"+10*e.size*p+"z"}),y.exit().remove(),TypeChecker.enabled&&_.each(t,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var b=s.links.selectAll("path.link").data(t,function(e){return e.id});b.attr("d",function(e){return a(e,f,c,p)}),p!==o&&b.style("stroke-width",function(e){return e.width*p}),TypeChecker.enabled&&_.each(n,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var w=s.nodes.selectAll("circle.node").data(n,function(e){return e.id});w.attr("cx",function(e){var t=f(e.x);return isNaN(t)?0:t}).attr("cy",function(e){var t=c(e.y);return isNaN(t)?0:t}),p!==o&&w.attr("r",function(e){return e.radius*p}).style("stroke-width",function(e){return e.borderWidth*p}),TypeChecker.enabled&&_.each(r,function(e){TypeChecker.checkProperties(e,e.propertyTypes,e.optionalPropertyTypes,!0)});var E=s.labels.selectAll("g.label").data(r,function(e){return e.id});E.attr("transform",function(e){return v(e,f,c)}),E.select("text").attr("text-anchor",function(e){return h(e,d)}).attr("x",function(e){var t=(h(e,d)==="end"?-e.offsetX:e.offsetX)*p;return isNaN(t)||t==Infinity?0:t}).attr("y",function(e){var t=e.offsetY*p;return isNaN(t)||t==Infinity?0:t}).style("font-size",function(e){return e.fontSize*p}),o=p},d()};return n}),t("futuregrapher/defaultgraphvisoptions",["require"],function(e){var t=function(e,t,n,r){return{width:(t.radius+n.radius)/10,color:d3.interpolateRgb(t.color,n.color)(.5),opacity:(t.opacity+n.opacity)/2}},n={enableZoom:!0,enablePan:!0,enableForce:!0,forceParameters:{linkDistance:20,linkStrength:1,friction:.9,charge:-30,chargeDistance:Infinity,theta:.8,gravity:.1},enableCollisionDetection:!0,enableClusterForce:!1,zoomExtent:[.25,4],zoomDensityScale:d3.scale.linear().domain([.25,4]).range([.5,2]),updateOnlyPositionsOnZoom:!0,updateOnlyPositionsOnTick:!0,onUpdatePreProcess:null,onUpdateAutoZoom:null,onUpdatePreRender:null,onClick:null,onNodeClick:null,onNodeDoubleClick:null,onNodeMouseOver:null,onNodeMouseOut:null,onNodeDragStart:null,onNodeDrag:null,onNodeDragEnd:null,onClusterNodeClick:null,onClusterNodeDoubleClick:null,onClusterNodeMouseOver:null,onClusterNodeMouseOut:null,onClusterNodeDragStart:null,onClusterNodeDrag:null,onClusterNodeDragEnd:null,onLinkClick:null,onLinkDoubleClick:null,onLinkMouseOver:null,onLinkMouseOut:null,onClusterClick:null,onClusterDoubleClick:null,onClusterMouseOver:null,onClusterMouseOut:null,defaultNodeDescription:{radius:10,color:"#888",borderColor:"#333",borderWidth:2,opacity:1,hoverText:null,label:null,fixed:!1},describeVisNode:null,defaultLinkDescription:{width:1,color:"#333",opacity:1,marker:!1,curvature:0,dashPattern:null,hoverText:null},describeVisLink:t,defaultCollapsedClusterDescription:{radius:20,color:"#aaa",borderColor:"#fff",borderWidth:2,opacity:1,hoverText:null,label:null,fixed:!1},describeCollapsedCluster:null,defaultExpandedClusterDescription:{color:"#a88",borderColor:null,opacity:.2,hoverText:null},describeExpandedCluster:null,defaultClusterLinkDescription:{width:2,color:"#222",opacity:1,marker:!1,curvature:0,dashPattern:null,hoverText:null},describeClusterLink:null};return n}),t("futuregrapher/nodecircle",["require","futuregrapher/typechecker"],function(e){var t=e("futuregrapher/typechecker"),n=function(e,t){this.id=e.toString(),this.visData=t};return n.prototype.propertyTypes=[t.string("id"),t.object("visData"),t.number("x"),t.number("y"),t.nonNegativeNumber("radius"),t.color("color"),t.color("borderColor"),t.nonNegativeNumber("borderWidth"),t.nonNegativeNumber("opacity"),t.string("hoverText"),t.boolean("fixed"),t.object("eventHandlers")],n.prototype.optionalPropertyTypes=[t.number("index"),t.number("px"),t.number("py"),t.number("weight")],n.prototype.updateProperties=function(e){t.checkProperties(e,[],this.propertyTypes,!0),_.extend(this,e)},n}),t("futuregrapher/linkline",["require","futuregrapher/typechecker"],function(e){var t=e("futuregrapher/typechecker"),n=function(e,t,n,r){this.id=e.toString(),this.source=t,this.target=n,this.visData=r};return n.prototype.propertyTypes=[t.string("id"),t.object("source"),t.object("target"),t.object("visData"),t.nonNegativeNumber("width"),t.color("color"),t.nonNegativeNumber("opacity"),t.boolean("marker"),t.number("curvature"),t.string("dashPattern"),t.string("hoverText"),t.object("eventHandlers")],n.prototype.optionalPropertyTypes=[],n.prototype.updateProperties=function(e){t.checkProperties(e,[],this.propertyTypes,!0),_.extend(this,e)},n}),t("futuregrapher/labeltext",["require","futuregrapher/typechecker"],function(e){var t=e("futuregrapher/typechecker"),n=function(e,t){this.id=e.toString(),this.data=t};return n.prototype.propertyTypes=[t.string("id"),t.object("data"),t.string("text"),t.number("x"),t.number("y"),t.number("offsetX"),t.number("offsetY"),t.string("anchor"),t.nonNegativeNumber("fontSize"),t.color("color"),t.color("borderColor"),t.nonNegativeNumber("opacity"),t.string("hoverText"),t.object("eventHandlers")],n.prototype.optionalPropertyTypes=[],n.prototype.updateProperties=function(e){t.checkProperties(e,[],this.propertyTypes,!0),_.extend(this,e)},n}),t("futuregrapher/clusterhull",["require","futuregrapher/typechecker"],function(e){var t=e("futuregrapher/typechecker"),n=function(e,t){this.id=e.toString(),this.data=t};return n.prototype.propertyTypes=[t.string("id"),t.object("data"),t.array("nodeCircles"),t.color("color"),t.color("borderColor"),t.nonNegativeNumber("opacity"),t.string("hoverText"),t.object("eventHandlers")],n.prototype.optionalPropertyTypes=[],n.prototype.updateProperties=function(e){t.checkProperties(e,[],this.propertyTypes,!0),_.extend(this,e)},n}),t("futuregrapher/graphvis",["require","futuregrapher/defaultgraphvisoptions","futuregrapher/nodecircle","futuregrapher/linkline","futuregrapher/labeltext","futuregrapher/clusterhull"],function(e){var t=e("futuregrapher/defaultgraphvisoptions"),n=e("futuregrapher/nodecircle"),r=e("futuregrapher/linkline"),i=e("futuregrapher/labeltext"),s=e("futuregrapher/clusterhull"),o=function(e,o){function E(){var e=b(S.scale()),t=e!==w;w=e,o.updateOnlyPositionsOnZoom?u.updatePositions("zoom"):u.update(null,null,null,0,"zoom"),o.enableForce&&o.enableCollisionDetection&&m&&t&&m.resume(),d3.event&&d3.event.sourceEvent&&d3.event.sourceEvent.stopPropagation()}function x(e){var t,n=e.id,r=_.find(h,function(e){return e.id===n});r?t=r:t=new s(n,null),t.eventHandlers={},o.onClusterClick&&(t.eventHandlers.click=o.onClusterClick),o.onClusterDoubleClick?t.eventHandlers.dblclick=o.onClusterDoubleClick:t.eventHandlers.dblclick=function(){e.isCollapsed=!0,u.update()},o.onClusterMouseOver&&(t.eventHandlers.mouseover=o.onClusterMouseOver),o.onClusterMouseOut&&(t.eventHandlers.mouseout=o.onClusterMouseOut),t.nodeCircles=[];var i=o.describeExpandedCluster?o.describeExpandedCluster(e,[],w):{},a=_.extend({},o.defaultExpandedClusterDescription,i);return t.updateProperties(a),t}function T(e,t,n,r,s,o,u){var a=_.isUndefined(e.offsetX)?0:e.offsetX,f=_.isUndefined(e.offsetY)?0:e.offsetY,l=e.anchor||"start",c=e.fontSize||14,h=e.color||s,p=e.borderColor||o,d=_.isUndefined(e.opacity)?u:description.opacity,v=e.hoverText||null,m={},g=new i(t,null),y={x:n,y:r,offsetX:0,offsetY:0,anchor:"start",fontSize:14,color:s,borderColor:o,opacity:u,hoverText:"",eventHandlers:{}};return g.updateProperties(y),g.updateProperties(e),g}function N(t){var r,i,s=t.id,u=_.find(d,function(e){return e.id===s});if(u)r=u;else{r=new n(s,t);if(t.clusterId){var a=_.find(d,function(e){return e.id==="placeholder-"+t.clusterId});a&&(r.x=a.x+Math.floor(Math.random()*10-5),r.y=a.y+Math.floor(Math.random()*10-5))}r.eventHandlers={},o.onNodeClick&&(r.eventHandlers.click=o.onNodeClick),o.onNodeDoubleClick&&(r.eventHandlers.dblclick=o.onNodeDoubleClick),o.onNodeMouseOver&&(r.eventHandlers.mouseover=o.onNodeMouseOver),o.onNodeMouseOut&&(r.eventHandlers.mouseout=o.onNodeMouseOut),o.onNodeMouseDown&&(r.eventHandlers.mousedown=o.onNodeMouseDown),o.onNodeMouseUp&&(r.eventHandlers.mouseup=o.onNodeMouseUp),o.onNodeDragStart&&(r.eventHandlers.dragstart=o.onNodeDragStart),o.onNodeDrag&&(r.eventHandlers.drag=o.onNodeDrag),o.onNodeDragEnd&&(r.eventHandlers.dragend=o.onNodeDragEnd)}var f=o.describeVisNode?o.describeVisNode(t,w):{},l=_.extend({},o.defaultNodeDescription,f);if(_.isNumber(l.x))r.x=l.x,r.px=l.x;else if(!_.isNumber(r.x)){var c=e.width(),h=c/2+(Math.random()*(c/2)-c/4);r.x=h,r.px=h}if(_.isNumber(l.y))r.y=l.y,r.py=l.y;else if(!_.isNumber(r.y)){var p=e.height(),v=p/2+(Math.random()*(p/2)-p/4);r.y=v,r.py=v}return _.isUndefined(l.label)||(_.isNull(l.label)||(i=T(l.label,s,r.x,r.y,l.color,l.borderColor,l.opacity)),delete l.label),r.updateProperties(l),{nodeCircle:r,labelText:i}}function C(t,r,i){var s,a,f="placeholder-"+t.id,l=_.find(d,function(e){return e.id===f});if(l)s=l;else{s=new n(f,{visCluster:t,visNodes:r,visLinks:i});var c=_.filter(d,function(e){return e.visData&&e.visData.clusterId===t.id});c.length&&(s.x=d3.mean(c,function(e){return e.x}),s.y=d3.mean(c,function(e){return e.y})),s.eventHandlers={},o.onClusterNodeClick&&(s.eventHandlers.click=o.onClusterNodeClick),o.onClusterNodeDoubleClick?s.eventHandlers.dblclick=o.onClusterNodeDoubleClick:s.eventHandlers.dblclick=function(){t.isCollapsed=!1,u.update()},o.onClusterNodeMouseOver&&(s.eventHandlers.mouseover=o.onClusterNodeMouseOver),o.onClusterNodeMouseOut&&(s.eventHandlers.mouseout=o.onClusterNodeMouseOut),o.onClusterNodeDragStart&&(s.eventHandlers.dragstart=o.onClusterNodeDragStart)}var h=o.describeCollapsedCluster?o.describeCollapsedCluster(t,r,w):{},p=_.extend({},o.defaultCollapsedClusterDescription,h);if(!_.isNumber(s.x)||!_.isNumber(s.y)){if(p.x)s.x=p.x;else{var v=e.width();s.x=v/2+(Math.random()*(v/2)-v/4)}if(p.y)s.y=p.y;else{var m=e.height();s.y=m/2+(Math.random()*(m/2)-m/4)}}return _.isUndefined(p.label)||(_.isNull(p.label)||(a=T(p.label,f,s.x,s.y,p.color,p.borderColor,p.opacity)),delete p.label),s.updateProperties(p),{nodeCircle:s,labelText:a}}function k(e,t,n){var i,s=t.id+"->"+n.id,u=_.find(p,function(e){return e.id===s});u?i=u:(i=new r(s,t,n,e),i.eventHandlers={},o.onLinkClick&&(i.eventHandlers.click=o.onLinkClick),o.onLinkDoubleClick&&(i.eventHandlers.dblclick=o.onLinkDoubleClick),o.onLinkMouseOver&&(i.eventHandlers.mouseover=o.onLinkMouseOver),o.onLinkMouseOut&&(i.eventHandlers.mouseout=o.onLinkMouseOut));var a=o.describeVisLink?o.describeVisLink(e,t,n,w):{},f=_.extend({},o.defaultLinkDescription,a);return i.updateProperties(f),i}function L(e,t,n){var i,s=e.id+"->"+t.id,u=_.find(p,function(e){return e.id===s});u?i=u:(i=new r(s,e,t,n),i.eventHandlers={},o.onLinkClick&&(i.eventHandlers.click=o.onLinkClick),o.onLinkDoubleClick&&(i.eventHandlers.dblclick=o.onLinkDoubleClick),o.onLinkMouseOver&&(i.eventHandlers.mouseover=o.onLinkMouseOver),o.onLinkMouseOut&&(i.eventHandlers.mouseout=o.onLinkMouseOut));var a=o.describeClusterLink?o.describeClusterLink(n,e,t,w):{},f=_.extend({},o.defaultClusterLinkDescription,a);return i.updateProperties(f),i}function A(e){return function(t){if(t.id.indexOf("placeholder")===0)return;var n=_.find(d,function(e){return e.visData.clusterId===t.data.clusterId});if(n===t)return;var r=t.x-n.x,i=t.y-n.y,s=Math.sqrt(r*r+i*i),o=(t.radius+n.radius)/S.scale()*w;s!=o&&(s=(s-o)/s*e,t.fixed||(t.x-=r*=s,t.y-=i*=s),n.fixed||(n.x+=r,n.y+=i))}}function O(e){var t=10,n=20,r=12,i=d3.geom.quadtree(d);return function(s){var o=(s.radius+r+Math.max(t,n))/S.scale()*w,u=s.x-o,a=s.x+o,f=s.y-o,l=s.y+o;i.visit(function(r,i,o,c,h){if(r.point&&r.point!==s){var p=s.x-r.point.x,d=s.y-r.point.y,v=Math.sqrt(p*p+d*d),m=(s.radius+r.point.radius+(s.visData.clusterId===r.point.visData.clusterId?t:n))/S.scale()*w;v<m&&(v=(v-m)/v*e,s.fixed||(s.x-=p*=v,s.y-=d*=v),r.point.fixed||(r.point.x+=p,r.point.y+=d))}return i>a||c<u||o>l||h<f})}}function M(e){o.enableClusterForce&&_(d).each(A(.01)),o.enableCollisionDetection&&_(d).each(O(.5)),_(v).each(function(e){var t=_.find(d,function(t){return t.id===e.id});e.x=t.x,e.y=t.y}),o.updateOnlyPositionsOnTick?u.updatePositions("tick"):u.update(null,null,null,0,"tick")}function D(){var t=d3.select(e.containerElement()[0]);o.enableZoom&&t.call(S).on("dblclick.zoom",null),o.onClick&&t.on("click",o.onClick),o.onMouseDown&&t.on("mousedown",o.onMouseDown),o.onMouseUp&&t.on("mouseup",o.onMouseUp),o.onMouseMove&&t.on("mousemove",o.onMouseMove)}var u=this;o=$.extend(!0,{},t,o);var a,f,l,c,h=[],p=[],d=[],v=[],m,g=d3.scale.linear().domain([0,e.width()]).range([0,e.width()]),y=d3.scale.linear().domain([0,e.height()]).range([0,e.height()]),b=o.zoomDensityScale,w=b(1),S=d3.behavior.zoom().x(g).y(y).scaleExtent(o.zoomExtent).on("zoom",E);this.unscaleCoords=function(e){var t=g.invert(e[0]),n=y.invert(e[1]);return[t,n]},this.update=function(t,n,r,i,s){t&&(a=t,f={},_.each(a,function(e){f[e.id]=e})),n&&(l=n),r&&(c=r),_.isUndefined(i)&&(i=250),s||(s="update");if(o.onUpdatePreProcess){var u={visNodes:a,visLinks:l,visClusters:c,transitionDuration:i};o.onUpdatePreProcess(u,s),a=u.visNodes,l=u.visLinks,c=u.visClusters,i=u.transitionDuration}var E=[],T={};_.each(c,function(e){e.isCollapsed?T[e.id]={visNodes:[],visLinks:[]}:E.push(x(e))});var A={},O=[];_.each(a,function(e){if(e.clusterId){var t=_.find(E,function(t){return t.id===e.clusterId});if(t){var n=N(e),r=n.nodeCircle;A[r.id]=r,t.nodeCircles.push(r),n.labelText&&O.push(n.labelText)}else{if(!T.hasOwnProperty(e.clusterId))throw"Node '"+e.id+"' refers to a cluster '"+e.clusterId+"' that wasn't defined";T[e.clusterId].visNodes.push(e)}}else{var n=N(e);A[n.nodeCircle.id]=n.nodeCircle,n.labelText&&O.push(n.labelText)}}),_.each(T,function(e,t){var n=_.find(c,function(e){return e.id===t}),r=C(n,e.visNodes,e.visLinks);A[r.nodeCircle.id]=r.nodeCircle,r.labelText&&O.push(r.labelText)});var M={},D=[];_.each(l,function(e){var t=f[e.sourceNodeId];if(!t)throw"Link refers to a source node '"+e.sourceNodeId+"' that wasn't found";var n=f[e.targetNodeId];if(!n)throw"Link refers to a target node '"+e.targetNodeId+"' that wasn't found";var r,i;t.clusterId&&(r=_.find(c,function(e){return e.id===t.clusterId})),n.clusterId&&(i=_.find(c,function(e){return e.id===n.clusterId}));var s=!1,o,u;r&&r.isCollapsed?(s=!0,o=A["placeholder-"+r.id]):o=A[t.id],i&&i.isCollapsed?(s=!0,u=A["placeholder-"+i.id]):u=A[n.id];if(s){var a=o.id+"->"+u.id;M.hasOwnProperty(a)||(M[a]={source:o,target:u,visLinks:[]}),M[a].visLinks.push(e)}else{var l=k(e,o,u);D.push(l)}}),_.each(M,function(e){var t=L(e.source,e.target,e.visLinks);D.push(t)}),A=_.map(A,function(e){return e});var P=!1;m&&(P=!_.isEqual(d,A)||!_.isEqual(p,D)),d=A,p=D,v=O,h=E;if(o.onUpdateAutoZoom){var H={clusterHulls:h,linkLines:p,nodeCircles:d,labelTexts:v},B=o.onUpdateAutoZoom(H,S.scale(),S.translate());B.scale&&S.scale(B.scale),B.translate&&S.translate(B.translate),w=b(S.scale()),w==Infinity&&(w=1)}if(o.onUpdatePreRender){var u={clusterHulls:h,linkLines:p,nodeCircles:d,labelTexts:v,xScale:g,yScale:y,radiusFactor:w,transitionDuration:i};o.onUpdatePreRender(u,s),h=u.clusterHulls,p=u.linkLines,d=u.nodeCircles,v=u.labelTexts,g=u.xScale,y=u.yScale,w=u.radiusFactor,i=u.transitionDuration}P&&(m.nodes(d),m.links(p),m.start()),e.update(h,p,d,v,g,y,w,i)},this.updatePositions=function(t){if(o.onUpdateAutoZoom){var n={clusterHulls:h,linkLines:p,nodeCircles:d,labelTexts:v},r=o.onUpdateAutoZoom(n,S.scale(),S.translate());r.scale&&S.scale(r.scale),r.translate&&S.translate(r.translate),w=b(S.scale()),w==Infinity&&(w=1)}if(o.onUpdatePreRender){var i={clusterHulls:h,linkLines:p,nodeCircles:d,labelTexts:v,xScale:g,yScale:y,radiusFactor:w,transitionDuration:transitionDuration};o.onUpdatePreRender(i,t),h=i.clusterHulls,p=i.linkLines,d=i.nodeCircles,v=i.labelTexts,g=i.xScale,y=i.yScale,w=i.radiusFactor,transitionDuration=i.transitionDuration}e.updatePositions(h,p,d,v,g,y,w)},this.startForce=function(){m?m.start():m=d3.layout.force().nodes(d).links(p).size([e.width(),e.height()]).linkDistance(o.forceParameters.linkDistance).linkStrength(o.forceParameters.linkStrength).friction(o.forceParameters.friction).charge(o.forceParameters.charge).theta(o.forceParameters.theta).gravity(o.forceParameters.gravity).on("tick",M).start()},this.resumeForce=function(){m.resume()},this.updateForceDynamics=function(e){_.extend(o.forceParameters,e),m&&(m.linkDistance(o.forceParameters.linkDistance).linkStrength(o.forceParameters.linkStrength).friction(o.forceParameters.friction).charge(o.forceParameters.charge).theta(o.forceParameters.theta).gravity(o.forceParameters.gravity),(e.hasOwnProperty("linkDistance")||e.hasOwnProperty("linkStrength")||e.hasOwnProperty("charge"))&&m.start())},this.stopForce=function(){m&&m.stop()},this.zoomPan=function(e,t){S.scale(e).translate(t),E()},this.getVisNode=function(e){if(d)return _.findWhere(d,{id:e.toString()})},D()};return o}),t("futuregrapher/visnode",["require"],function(e){var t=function(e,t,n){this.id=e,this.data=t,this.clusterId=n};return t}),t("futuregrapher/vislink",["require"],function(e){var t=function(e,t,n){this.sourceNodeId=e,this.targetNodeId=t,this.data=n};return t}),t("futuregrapher/viscluster",["require"],function(e){var t=function(e,t,n){this.id=e,this.data=t,this.isCollapsed=n};return t}),t("futuregrapher/autozoomer",["require"],function(e){var t=function(e){function o(o,u,a){if(!t)return{};if(s)return s;if(i&&(new Date).getTime()>i)return i=null,t=!1,{};var f=d3.extent(o.nodeCircles,function(e){return e.x}),l=d3.extent(o.nodeCircles,function(e){return e.y});if(!f[0]||!l[0])return{};var c=e.width()-n*2,h=e.height()-n*2,p=c/2,d=h/2,v=f[1]-f[0],m=l[1]-l[0],g=f[0]+v/2,y=l[0]+m/2,b=Math.min(h/m,c/v);b<r[0]&&(u=r[0]),b>r[1]&&(u=r[1]);var w=p-g*b+n,E=d-y*b+n;return{scale:b,translate:[w,E]}}var t=!0,n=20,r=[.25,4],i,s=null;return o.enable=function(){return s=null,t=!0,o},o.disable=function(){return t=!1,o},o.enabled=function(){return t},o.fix=function(e){return arguments.length?(s=e,t=!0,i=null,o):s},o.margin=function(e){return arguments.length?(n=e,o):n},o.zoomExtent=function(e){return arguments.length?(r=e,o):r},o.terminateIn=function(e){var n=(new Date).getTime();return arguments.length?(s=null,t=!0,i=n+e,o):i-n},o};return t}),t("futuregrapher/autoradiusscale",["require"],function(e){var t=function(){function n(){return r}function r(n){return Math.sqrt(e*e*(n/t))}var e=10,t=100;return r.maxRadius=function(t){return arguments.length?(e=t,n()):e},r.maxInputValue=function(e){return arguments.length?(t=e,n()):t},n()};return t}),t("futuregrapher/gradientscale",["require"],function(e){var t=function(){function i(){return n.domain(e).range([0,t.length-1]),r.domain(d3.range(0,t.length)).range(t),s}function s(e){return r(n(e))}var e=[0,1],t=["#333","#aaa"],n=d3.scale.linear(),r=d3.scale.linear().range(t);return s.domain=function(t){return arguments.length?(e=t,i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},i()};return t}),t("futuregrapher",["require","futuregrapher/core","futuregrapher/typechecker","futuregrapher/svgrenderer","futuregrapher/graphvis","futuregrapher/visnode","futuregrapher/vislink","futuregrapher/viscluster","futuregrapher/nodecircle","futuregrapher/labeltext","futuregrapher/linkline","futuregrapher/clusterhull","futuregrapher/autozoomer","futuregrapher/autoradiusscale","futuregrapher/gradientscale"],function(e){var t=e("futuregrapher/core");return t.TypeChecker=e("futuregrapher/typechecker"),t.SvgRenderer=e("futuregrapher/svgrenderer"),t.GraphVis=e("futuregrapher/graphvis"),t.VisNode=e("futuregrapher/visnode"),t.VisLink=e("futuregrapher/vislink"),t.VisCluster=e("futuregrapher/viscluster"),t.NodeCircle=e("futuregrapher/nodecircle"),t.LabelText=e("futuregrapher/labeltext"),t.LinkLine=e("futuregrapher/linkline"),t.ClusterHull=e("futuregrapher/clusterhull"),t.autoZoomer=e("futuregrapher/autozoomer"),t.autoRadiusScale=e("futuregrapher/autoradiusscale"),t.gradientScale=e("futuregrapher/gradientscale"),t});var X=s("futuregrapher");typeof module!="undefined"&&module.exports?module.exports=X:n?function(e){e(function(){return X})}(n):typeof Meteor!="undefined"?futuregrapher=X:e.futuregrapher=X})(this);